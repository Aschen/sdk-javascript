!function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){function n(){var e=this,t=Date.now(),r=-1;e.queueTTL>0&&(e.offlineQueue.forEach(function(n,i){n.ts<t-e.queueTTL&&(r=i)}),r!==-1&&e.offlineQueue.splice(0,r+1).forEach(function(t){e.emitEvent("offlineQueuePop",t.query)})),e.queueMaxSize>0&&e.offlineQueue.length>e.queueMaxSize&&e.offlineQueue.splice(0,e.offlineQueue.length-e.queueMaxSize).forEach(function(t){e.emitEvent("offlineQueuePop",t.query)})}function i(e){var t=Date.now();Object.keys(e).forEach(function(r){e[r]<t-1e4&&delete e[r]}),setTimeout(function(){i(e)},1e3)}function o(e,t){var r=this;(void 0!==r.jwtToken||t)&&r.network.once(e.requestId,function(n){"logout"!==e.action&&n.error&&"Token expired"===n.error.message&&(r.jwtToken=void 0,r.emitEvent("jwtTokenExpired",e,t)),t&&t(n.error,n)}),this.network.send(e),r.requestHistory[e.requestId]=Date.now()}function s(){var e,t=this,r={},n=function(){t.offlineQueue.length>0?(o.call(t,t.offlineQueue[0].query,t.offlineQueue[0].cb),t.emitEvent("offlineQueuePop",t.offlineQueue.shift()),setTimeout(function(){n()},Math.max(0,t.replayInterval))):t.queuing=!1};if(t.offlineQueueLoader){if("function"!=typeof t.offlineQueueLoader)throw new Error("Invalid value for offlineQueueLoader property. Expected: function. Got: "+typeof t.offlineQueueLoader);if(e=t.offlineQueueLoader(),!Array.isArray(e))throw new Error("Invalid value returned by the offlineQueueLoader function. Expected: array. Got: "+typeof e);t.offlineQueue=e.concat(t.offlineQueue).filter(function(e){if(!e.query||void 0===e.query.requestId||!e.query.action||!e.query.controller)throw new Error("Invalid offline queue request. One or more missing properties: requestId, action, controller.");return!r.hasOwnProperty(e.query.requestId)&&(r[e.query.requestId]=!0)})}n()}function u(){var e=this;Object.keys(e.subscriptions).forEach(function(t){Object.keys(e.subscriptions[t]).forEach(function(r){var n=e.subscriptions[t][r];n.renew(n.callback)})})}var l=r(3),a=r(25),c=r(36),f=r(28),h=r(5),d=r(30);e.exports=Kuzzle=function(e,t,r){var n=this;if(!(this instanceof Kuzzle))return new Kuzzle(e,t,r);if(r||"function"!=typeof t||(r=t,t=null),!e||""===e)throw new Error("host argument missing");return Object.defineProperties(this,{collections:{value:{},writable:!0},connectCB:{value:r},eventListeners:{value:{connected:{lastEmitted:null,listeners:[]},error:{lastEmitted:null,listeners:[]},disconnected:{lastEmitted:null,listeners:[]},reconnected:{lastEmitted:null,listeners:[]},jwtTokenExpired:{lastEmitted:null,listeners:[]},loginAttempt:{lastEmitted:null,listeners:[]},offlineQueuePush:{listeners:[]},offlineQueuePop:{listeners:[]}}},eventTimeout:{value:200},queuing:{value:!1,writable:!0},requestHistory:{value:{},writable:!0},state:{value:"initializing",writable:!0},subscriptions:{value:{pending:{}},writable:!0},autoReconnect:{value:!t||"boolean"!=typeof t.autoReconnect||t.autoReconnect,enumerable:!0},defaultIndex:{value:t&&"string"==typeof t.defaultIndex?t.defaultIndex:void 0,writable:!0,enumerable:!0},reconnectionDelay:{value:t&&"number"==typeof t.reconnectionDelay?t.reconnectionDelay:1e3,enumerable:!0},host:{value:e,enumerable:!0},wsPort:{value:t&&"number"==typeof t.wsPort?t.wsPort:7513,enumerable:!0},ioPort:{value:t&&"number"==typeof t.ioPort?t.ioPort:7512,enumerable:!0},autoQueue:{value:!1,enumerable:!0,writable:!0},autoReplay:{value:!1,enumerable:!0,writable:!0},autoResubscribe:{value:!0,enumerable:!0,writable:!0},headers:{value:{},enumerable:!0,writable:!0},metadata:{value:{},enumerable:!0,writable:!0},offlineQueue:{value:[],enumerable:!0,writable:!0},queueFilter:{value:null,enumerable:!0,writable:!0},queueMaxSize:{value:500,enumerable:!0,writable:!0},queueTTL:{value:12e4,enumerable:!0,writable:!0},replayInterval:{value:10,enumerable:!0,writable:!0},jwtToken:{value:void 0,enumerable:!0,writable:!0},offlineQueueLoader:{value:null,enumerable:!0,writable:!0}}),t&&(Object.keys(t).forEach(function(e){n.hasOwnProperty(e)&&Object.getOwnPropertyDescriptor(n,e).writable&&(n[e]=t[e])}),"auto"===t.offlineMode&&this.autoReconnect&&(this.autoQueue=this.autoReplay=this.autoResubscribe=!0)),Object.defineProperty(this,"isValid",{value:function(){if("disconnected"===n.state)throw new Error("This Kuzzle object has been invalidated. Did you try to access it after a disconnect call?")}}),Object.defineProperty(this,"addHeaders",{value:function(e,t){return Object.keys(t).forEach(function(r){e[r]||(e[r]=t[r])}),e}}),Object.defineProperty(this,"callbackRequired",{value:function(e,t){if(!t||"function"!=typeof t)throw new Error(e+": a callback argument is required for read queries")}}),Object.defineProperty(this,"security",{value:new c(this),enumerable:!0}),Object.defineProperty(this,"emitEvent",{value:function(e){var t=Date.now(),r=Array.prototype.slice.call(arguments,1),n=this.eventListeners[e];return!(n.lastEmitted&&n.lastEmitted>=t-this.eventTimeout)&&(n.listeners.forEach(function(e){process.nextTick(function(){e.fn.apply(void 0,r)})}),void(void 0!==n.lastEmitted&&(n.lastEmitted=t)))}}),Object.defineProperty(this,"memoryStorage",{value:new f(this),enumerable:!0}),t&&t.connect&&"auto"!==t.connect?this.state="ready":this.connect(),i(this.requestHistory),this.bluebird?this.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["getAllStatistics","getServerInfo","getStatistics","listCollections","listIndexes","login","logout","now","query","checkToken","whoAmI"];return n&&i.indexOf(e)!==-1}}):void 0},Kuzzle.prototype.connect=function(){var e=this;return e.network||(e.network=d(e.host,e.wsPort,e.ioPort)),["initializing","ready","disconnected","error","offline"].indexOf(this.state)===-1?(e.connectCB&&e.connectCB(null,e),e):(e.state="connecting",e.network.connect(e.autoReconnect,e.reconnectionDelay),e.network.onConnect(function(){e.state="connected",u.call(e),s.call(e),e.emitEvent("connected"),e.connectCB&&e.connectCB(null,e)}),e.network.onConnectError(function(t){var r=new Error('Unable to connect to kuzzle server at "'+e.host+'"');r.internal=t,e.state="error",e.emitEvent("error",r),e.connectCB&&e.connectCB(r)}),e.network.onDisconnect(function(){e.state="offline",e.autoReconnect||e.disconnect(),e.autoQueue&&(e.queuing=!0),e.emitEvent("disconnected")}),e.network.onReconnect(function(){var t=function(){e.autoResubscribe&&u.call(e),e.autoReplay&&(n.call(e),s.call(e)),e.emitEvent("reconnected")};e.state="connected",e.jwtToken?e.checkToken(e.jwtToken,function(r,n){!r&&n.valid||(e.jwtToken=void 0,e.emitEvent("jwtTokenExpired")),t()}):t()}),this)},Kuzzle.prototype.setJwtToken=function(e){if("string"==typeof e)this.jwtToken=e;else{if("object"!=typeof e)return this.emitEvent("loginAttempt",{success:!1,error:"Invalid token argument: "+e}),this;if(!e.result||!e.result.jwt||"string"!=typeof e.result.jwt)return this.emitEvent("loginAttempt",{success:!1,error:"Cannot find a valid JWT token in the following object: "+JSON.stringify(e)}),this;this.jwtToken=e.result.jwt}return u.call(this),this.emitEvent("loginAttempt",{success:!0}),this},Kuzzle.prototype.getJwtToken=function(){return this.jwtToken},Kuzzle.prototype.login=function(e){var t,r,n=this,i={strategy:e};return arguments[1]&&("object"==typeof arguments[1]?t=arguments[1]:"number"==typeof arguments[1]||"string"==typeof arguments[1]?i.expiresIn=arguments[1]:"function"==typeof arguments[1]&&(r=arguments[1])),arguments[2]&&("number"==typeof arguments[2]||"string"==typeof arguments[2]?i.expiresIn=arguments[2]:"function"==typeof arguments[2]&&(r=arguments[2])),arguments[3]&&"function"==typeof arguments[3]&&(r=arguments[3]),"object"==typeof t&&Object.keys(t).forEach(function(e){i[e]=t[e]}),this.query({controller:"auth",action:"login"},{body:i},{queuable:!1},function(e,t){e?(r&&"function"==typeof r&&r(e),n.emitEvent("loginAttempt",{success:!1,error:e.message})):(t.result.jwt&&n.setJwtToken(t.result.jwt),r&&"function"==typeof r&&r(null,t.result))}),n},Kuzzle.prototype.logout=function(e){var t=this,r={action:"logout",controller:"auth",requestId:l.v4(),body:{}};return this.query({controller:"auth",action:"logout"},r,{queuable:!1},function(r){null===r?(t.jwtToken=void 0,"function"==typeof e&&e(null,t)):"function"==typeof e&&e(r)}),t},Kuzzle.prototype.checkToken=function(e,t){var r=this,n={body:{token:e}};return this.callbackRequired("Kuzzle.checkToken",t),this.query({controller:"auth",action:"checkToken"},n,{queuable:!1},function(e,r){return e?t(e):void t(null,r.result)}),r},Kuzzle.prototype.whoAmI=function(e){var t=this;return t.callbackRequired("Kuzzle.whoAmI",e),t.query({controller:"auth",action:"getCurrentUser"},{},{},function(r,n){return r?e(r):void e(null,new h(t.security,n.result._id,n.result._source))}),t},Kuzzle.prototype.getMyRights=function(e,t){var r=this;t||"function"!=typeof e||(t=e,e=null),r.callbackRequired("Kuzzle.getMyRights",t),r.query({controller:"auth",action:"getMyRights"},{},null,function(e,r){return e?t(e):void t(null,r.result.hits)})},Kuzzle.prototype.updateSelf=function(e,t,r){var n=this,i={},o={controller:"auth",action:"updateSelf"};r||"function"!=typeof t||(r=t,t=null),i.body=e,r?n.query(o,i,t,function(e,t){return e?r(e):void r(null,t.result)}):n.query(o,i,t)},Kuzzle.prototype.addListener=function(e,t){var r,n=Object.keys(this.eventListeners),i=typeof t;if(this.isValid(),n.indexOf(e)===-1)throw new Error("["+e+"] is not a known event. Known events: "+n.toString());if("function"!==i)throw new Error("Invalid listener type: expected a function, got a "+i);return r=l.v4(),this.eventListeners[e].listeners.push({id:r,fn:t}),r},Kuzzle.prototype.getAllStatistics=function(e,t){return t||"function"!=typeof e||(t=e,e=null),this.callbackRequired("Kuzzle.getAllStatistics",t),this.query({controller:"admin",action:"getAllStats"},{},e,function(e,r){return e?t(e):void t(null,r.result.hits)}),this},Kuzzle.prototype.getStatistics=function(e,t,r){var n;return r||(1===arguments.length?(r=arguments[0],t=null,e=null):(r=arguments[1],"object"==typeof arguments[0]?(t=arguments[0],e=null):(e=arguments[0],t=null))),n=function(t,n){return t?r(t):void(e?r(null,n.result.hits):r(null,[n.result]))},this.callbackRequired("Kuzzle.getStatistics",r),e?this.query({controller:"admin",action:"getStats"},{body:{startTime:e}},t,n):this.query({controller:"admin",action:"getLastStats"},{},t,n),this},Kuzzle.prototype.dataCollectionFactory=function(e,t){if(this.isValid(),!t){if(!this.defaultIndex)throw new Error("Unable to create a new data collection object: no index specified");t=this.defaultIndex}if("string"!=typeof t)throw new Error('Invalid "index" argument: string expected, got '+typeof t);if("string"!=typeof e)throw new Error('Invalid "collection" argument: string expected, got '+typeof e);return this.collections[t]||(this.collections[t]={}),this.collections[t][e]||(this.collections[t][e]=new a(this,t,e)),this.collections[t][e]},Kuzzle.prototype.flushQueue=function(){return this.offlineQueue=[],this},Kuzzle.prototype.listCollections=function(){var e,t,r,n="all",i=Array.prototype.slice.call(arguments);if(i.forEach(function(n){switch(typeof n){case"string":e=n;break;case"object":t=n;break;case"function":r=n}}),!e){if(!this.defaultIndex)throw new Error("Kuzzle.listCollections: index required");e=this.defaultIndex}return this.callbackRequired("Kuzzle.listCollections",r),t&&t.type&&(n=t.type),this.query({index:e,controller:"read",action:"listCollections"},{body:{type:n}},t,function(e,t){return e?r(e):r(null,t.result.collections)}),this},Kuzzle.prototype.listIndexes=function(e,t){return t||"function"!=typeof e||(t=e,e=null),this.callbackRequired("Kuzzle.listIndexes",t),this.query({controller:"read",action:"listIndexes"},{},e,function(e,r){return e?t(e):t(null,r.result.indexes)}),this},Kuzzle.prototype.disconnect=function(){var e;this.logout(),this.state="disconnected",this.network.close();for(e in this.collections)this.collections.hasOwnProperty(e)&&delete this.collections[e]},Kuzzle.prototype.getServerInfo=function(e,t){return t||"function"!=typeof e||(t=e,e=null),this.callbackRequired("Kuzzle.getServerInfo",t),this.query({controller:"read",action:"serverInfo"},{},e,function(e,r){return e?t(e):void t(null,r.result.serverInfo)}),this},Kuzzle.prototype.refreshIndex=function(){var e,t,r;if(Array.prototype.slice.call(arguments).forEach(function(n){switch(typeof n){case"string":e=n;break;case"object":t=n;break;case"function":r=n}}),!e){if(!this.defaultIndex)throw new Error("Kuzzle.refreshIndex: index required");e=this.defaultIndex}return this.query({index:e,controller:"admin",action:"refreshIndex"},{},t,r),this},Kuzzle.prototype.getAutoRefresh=function(){var e,t,r;if(Array.prototype.slice.call(arguments).forEach(function(n){switch(typeof n){case"string":e=n;break;case"object":t=n;break;case"function":r=n}}),!e){if(!this.defaultIndex)throw new Error("Kuzzle.getAutoRefresh: index required");e=this.defaultIndex}return this.callbackRequired("Kuzzle.getAutoRefresh",r),this.query({index:e,controller:"admin",action:"getAutoRefresh"},{},t,r),this},Kuzzle.prototype.setAutoRefresh=function(){var e,t,r,n;if(Array.prototype.slice.call(arguments).forEach(function(i){switch(typeof i){case"string":e=i;break;case"boolean":t=i;break;case"object":r=i;break;case"function":n=i}}),!e){if(!this.defaultIndex)throw new Error("Kuzzle.setAutoRefresh: index required");e=this.defaultIndex}if(void 0===t)throw new Error("Kuzzle.setAutoRefresh: autoRefresh value is required");return this.query({index:e,controller:"admin",action:"setAutoRefresh"},{body:{autoRefresh:t}},r,n),this},Kuzzle.prototype.now=function(e,t){return t||"function"!=typeof e||(t=e,e=null),this.callbackRequired("Kuzzle.now",t),this.query({controller:"read",action:"now"},{},e,function(e,r){return e?t(e):void t(null,r.result.now)}),this},Kuzzle.prototype.query=function(e,t,r,i){var s,u={action:e.action,controller:e.controller,metadata:this.metadata},a=this;if(this.isValid(),i||"function"!=typeof r||(i=r,r=null),r&&(r.metadata&&Object.keys(r.metadata).forEach(function(e){u.metadata[e]=r.metadata[e]}),r.queuable===!1&&"offline"===a.state))return a;if(!t||"object"!=typeof t||Array.isArray(t))throw new Error("Invalid query parameter: "+t);t.metadata&&Object.keys(t.metadata).forEach(function(e){u.metadata[e]=t.metadata[e]});for(s in t)"metadata"!==s&&t.hasOwnProperty(s)&&(u[s]=t[s]);return u=a.addHeaders(u,this.headers),void 0===a.jwtToken||"auth"===u.controller&&"checkToken"===u.action||(u.headers=u.headers||{},u.headers.authorization="Bearer "+a.jwtToken),e.collection&&(u.collection=e.collection),e.index&&(u.index=e.index),u.requestId||(u.requestId=l.v4()),"connected"===a.state||r&&r.queuable===!1?"connected"===a.state?o.call(this,u,i):i&&i(new Error("Unable to execute request: not connected to a Kuzzle server.\nDiscarded request: "+JSON.stringify(u))):(a.queuing||["initializing","connecting"].indexOf(a.state)!==-1)&&(n.call(this,u,i),a.queueFilter&&!a.queueFilter(u)||(a.offlineQueue.push({ts:Date.now(),query:u,cb:i}),a.emitEvent("offlineQueuePush",{query:u,cb:i}))),a},Kuzzle.prototype.removeAllListeners=function(e){var t=Object.keys(this.eventListeners),r=this;if(e){if(t.indexOf(e)===-1)throw new Error("["+e+"] is not a known event. Known events: "+t.toString());this.eventListeners[e].listeners=[]}else t.forEach(function(e){r.eventListeners[e].listeners=[]})},Kuzzle.prototype.removeListener=function(e,t){var r=Object.keys(this.eventListeners),n=this;if(r.indexOf(e)===-1)throw new Error("["+e+"] is not a known event. Known events: "+r.toString());this.eventListeners[e].listeners.forEach(function(r,i){r.id===t&&n.eventListeners[e].listeners.splice(i,1)})},Kuzzle.prototype.replayQueue=function(){return"offline"===this.state||this.autoReplay||(n.call(this),s.call(this)),this},Kuzzle.prototype.setDefaultIndex=function(e){if("string"!=typeof e)throw new Error("Invalid default index: ["+e+"] (an index name is expected)");if(0===e.length)throw new Error("Cannot set an empty index as the default index");return this.defaultIndex=e,this},Kuzzle.prototype.setHeaders=function(e,t){var r=this;if("object"!=typeof e||Array.isArray(e))throw new Error("Expected a content object, received a "+typeof e);return t?r.headers=e:Object.keys(e).forEach(function(t){r.headers[t]=e[t]}),r},Kuzzle.prototype.startQueuing=function(){return"offline"!==this.state||this.autoQueue||(this.queuing=!0),this},Kuzzle.prototype.stopQueuing=function(){return"offline"!==this.state||this.autoQueue||(this.queuing=!1),this}},function(e,t,r){function n(e,r){var n={seen:[],stylize:o};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(r)?n.showHidden=r:r&&t._extend(n,r),z(n.showHidden)&&(n.showHidden=!1),z(n.depth)&&(n.depth=2),z(n.colors)&&(n.colors=!1),z(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=i),u(n,e,n.depth)}function i(e,t){var r=n.styles[t];return r?"["+n.colors[r][0]+"m"+e+"["+n.colors[r][1]+"m":e}function o(e,t){return e}function s(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function u(e,r,n){if(e.customInspect&&r&&A(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return g(i)||(i=u(e,i,n)),i}var o=l(e,r);if(o)return o;var p=Object.keys(r),y=s(p);if(e.showHidden&&(p=Object.getOwnPropertyNames(r)),E(r)&&(p.indexOf("message")>=0||p.indexOf("description")>=0))return a(r);if(0===p.length){if(A(r)){var b=r.name?": "+r.name:"";return e.stylize("[Function"+b+"]","special")}if(m(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(k(r))return e.stylize(Date.prototype.toString.call(r),"date");if(E(r))return a(r)}var v="",w=!1,z=["{","}"];if(d(r)&&(w=!0,z=["[","]"]),A(r)){var _=r.name?": "+r.name:"";v=" [Function"+_+"]"}if(m(r)&&(v=" "+RegExp.prototype.toString.call(r)),k(r)&&(v=" "+Date.prototype.toUTCString.call(r)),E(r)&&(v=" "+a(r)),0===p.length&&(!w||0==r.length))return z[0]+v+z[1];if(n<0)return m(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special");e.seen.push(r);var I;return I=w?c(e,r,n,y,p):p.map(function(t){return f(e,r,n,y,t,w)}),e.seen.pop(),h(I,v,z)}function l(e,t){if(z(t))return e.stylize("undefined","undefined");if(g(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return v(t)?e.stylize(""+t,"number"):p(t)?e.stylize(""+t,"boolean"):y(t)?e.stylize("null","null"):void 0}function a(e){return"["+Error.prototype.toString.call(e)+"]"}function c(e,t,r,n,i){for(var o=[],s=0,u=t.length;s<u;++s)S(t,String(s))?o.push(f(e,t,r,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(f(e,t,r,n,i,!0))}),o}function f(e,t,r,n,i,o){var s,l,a;if(a=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},a.get?l=a.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):a.set&&(l=e.stylize("[Setter]","special")),S(n,i)||(s="["+i+"]"),l||(e.seen.indexOf(a.value)<0?(l=y(r)?u(e,a.value,null):u(e,a.value,r-1),l.indexOf("\n")>-1&&(l=o?l.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+l.split("\n").map(function(e){return"   "+e}).join("\n"))):l=e.stylize("[Circular]","special")),z(s)){if(o&&i.match(/^\d+$/))return l;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+l}function h(e,t,r){var n=0,i=e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function d(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function y(e){return null===e}function b(e){return null==e}function v(e){return"number"==typeof e}function g(e){return"string"==typeof e}function w(e){return"symbol"==typeof e}function z(e){return void 0===e}function m(e){return _(e)&&"[object RegExp]"===x(e)}function _(e){return"object"==typeof e&&null!==e}function k(e){return _(e)&&"[object Date]"===x(e)}function E(e){return _(e)&&("[object Error]"===x(e)||e instanceof Error)}function A(e){return"function"==typeof e}function I(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function x(e){return Object.prototype.toString.call(e)}function R(e){return e<10?"0"+e.toString(10):e.toString(10)}function q(){var e=new Date,t=[R(e.getHours()),R(e.getMinutes()),R(e.getSeconds())].join(":");return[e.getDate(),j[e.getMonth()],t].join(" ")}function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var B=/%[sdj%]/g;t.format=function(e){if(!g(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(n(arguments[r]));return t.join(" ")}for(var r=1,i=arguments,o=i.length,s=String(e).replace(B,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(t){return"[Circular]"}default:return e}}),u=i[r];r<o;u=i[++r])s+=y(u)||!_(u)?" "+u:" "+n(u);return s},t.deprecate=function(e,r){function n(){if(!i){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),i=!0}return e.apply(this,arguments)}if(z(global.process))return function(){return t.deprecate(e,r).apply(this,arguments)};if(process.noDeprecation===!0)return e;var i=!1;return n};var P,O={};t.debuglog=function(e){if(z(P)&&(P={NODE_ENV:"production"}.NODE_DEBUG||""),e=e.toUpperCase(),!O[e])if(new RegExp("\\b"+e+"\\b","i").test(P)){var r=process.pid;O[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n)}}else O[e]=function(){};return O[e]},t.inspect=n,n.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},n.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=p,t.isNull=y,t.isNullOrUndefined=b,t.isNumber=v,t.isString=g,t.isSymbol=w,t.isUndefined=z,t.isRegExp=m,t.isObject=_,t.isDate=k,t.isError=E,t.isFunction=A,t.isPrimitive=I,t.isBuffer=r(24);var j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.log=function(){console.log("%s - %s",q(),t.format.apply(t,arguments))},t.inherits=r(23),t._extend=function(e,t){if(!t||!_(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}},function(e,t){function r(e,t,r){if(!t)throw new Error("A security document must have an id");if(Object.defineProperties(this,{kuzzle:{value:e.kuzzle},kuzzleSecurity:{value:e},id:{value:t,enumerable:!0},content:{value:{},writable:!0,enumerable:!0}}),r&&this.setContent(r,!0),e.kuzzle.bluebird)return e.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["delete","update"];return n&&i.indexOf(e)!==-1}})}r.prototype.setContent=function(e){return this.content=e,this},r.prototype.serialize=function(){var e={};return this.id&&(e._id=this.id),e.body=this.content,e},r.prototype["delete"]=function(e,t){var r=this;e&&void 0===t&&"function"==typeof e&&(t=e,e=null),r.kuzzle.query(this.kuzzleSecurity.buildQueryArgs(this.deleteActionName),{_id:this.id},e,function(e,r){return e?!!t&&t(e):void(t&&t(null,r.result._id))})},r.prototype.update=function(e,t,r){var n={},i=this;if("object"!=typeof e)throw new Error('Parameter "content" must be a object');t&&void 0===r&&"function"==typeof t&&(r=t,t=null),n._id=i.id,n.body=e,i.kuzzle.query(this.kuzzleSecurity.buildQueryArgs(this.updateActionName),n,t,function(e,t){return e?!!r&&r(e):(i.setContent(t.result._source),void(r&&r(null,i)))})},e.exports=r},function(e,t,r){var n;!function(i){"use strict";function o(){var e=i.crypto||i.msCrypto;if(!f&&e&&e.getRandomValues)try{var t=new Uint8Array(16);p=f=function(){return e.getRandomValues(t),t},f()}catch(r){}if(!f){var n=new Array(16);h=f=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}function s(){try{var e=r(12).randomBytes;d=f=e&&function(){return e(16)},f()}catch(t){}}function u(e,t,r){var n=t&&r||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){i<16&&(t[n+i++]=v[e])});i<16;)t[n+i++]=0;return t}function l(e,t){var r=t||0,n=b;return n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]}function a(e,t,r){var n=t&&r||0,i=t||[];e=e||{};var o=null!=e.clockseq?e.clockseq:m,s=null!=e.msecs?e.msecs:(new Date).getTime(),u=null!=e.nsecs?e.nsecs:k+1,a=s-_+(u-k)/1e4;if(a<0&&null==e.clockseq&&(o=o+1&16383),(a<0||s>_)&&null==e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_=s,k=u,m=o,s+=122192928e5;var c=(1e4*(268435455&s)+u)%4294967296;i[n++]=c>>>24&255,i[n++]=c>>>16&255,i[n++]=c>>>8&255,i[n++]=255&c;var f=s/4294967296*1e4&268435455;i[n++]=f>>>8&255,i[n++]=255&f,i[n++]=f>>>24&15|16,i[n++]=f>>>16&255,i[n++]=o>>>8|128,i[n++]=255&o;for(var h=e.node||z,d=0;d<6;d++)i[n+d]=h[d];return t?t:l(i)}function c(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new y(16):null,e=null),e=e||{};var i=e.random||(e.rng||f)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;o++)t[n+o]=i[o];return t||l(i)}var f,h,d,p;i?o():s();for(var y="function"==typeof Buffer?Buffer:Array,b=[],v={},g=0;g<256;g++)b[g]=(g+256).toString(16).substr(1),v[b[g]]=g;var w=f(),z=[1|w[0],w[1],w[2],w[3],w[4],w[5]],m=16383&(w[6]<<8|w[7]),_=0,k=0,E=c;E.v1=a,E.v4=c,E.parse=u,E.unparse=l,E.BufferClass=y,E._rng=f,E._mathRNG=h,E._nodeRNG=d,E._whatwgRNG=p,"undefined"!=typeof e&&e.exports?e.exports=E:(n=function(){return E}.call(t,r,t,e),!(void 0!==n&&(e.exports=n)))}("undefined"!=typeof window?window:null)},function(e,t,r){function n(e){return function(){var t=[],r={update:function(e,r){return Buffer.isBuffer(e)||(e=new Buffer(e,r)),t.push(e),this},digest:function(r){var n=Buffer.concat(t),i=e(n);return t=null,r?i.toString(r):i}};return r}}var i=r(17),o=n(r(13)),s=n(r(15));e.exports=function(e){return"md5"===e?new o:"rmd160"===e?new s:i(e)}},function(e,t,r){function n(e,t,r){if(i.call(this,e,t,r),Object.defineProperties(this,{deleteActionName:{value:"deleteUser"},updateActionName:{value:"updateUser"}}),e.kuzzle.bluebird)return e.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["save"];return n&&i.indexOf(e)!==-1}})}var i=r(2);n.prototype=Object.create(i.prototype,{constructor:{value:n}}),n.prototype.setProfiles=function(e){if(!Array.isArray(e)||"string"!=typeof e[0])throw new Error('Parameter "profilesIds" must be an array of strings');return this.content.profilesIds=e,this},n.prototype.addProfile=function(e){if("string"!=typeof e)throw new Error('Parameter "profileId" must be a string');return this.content.profilesIds||(this.content.profilesIds=[]),this.content.profilesIds.indexOf(e)===-1&&this.content.profilesIds.push(e),this},n.prototype.save=function(e,t){var r=this.serialize(),n=this;return e&&void 0===t&&"function"==typeof e&&(t=e,e=null),n.kuzzle.query(this.kuzzleSecurity.buildQueryArgs("createOrReplaceUser"),r,e,function(e){return e?!!t&&t(e):void(t&&t(null,n))}),n},n.prototype.serialize=function(){var e={};return this.id&&(e._id=this.id),e.body=this.content,e},n.prototype.getProfiles=function(){return this.content.profilesIds},e.exports=n},function(e,t,r){/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
"use strict";function n(){function e(){}try{var t=new Uint8Array(1);return t.foo=function(){return 42},t.constructor=e,42===t.foo()&&t.constructor===e&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(r){return!1}}function i(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e){return this instanceof o?(o.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof e?s(this,e):"string"==typeof e?u(this,e,arguments.length>1?arguments[1]:"utf8"):l(this,e)):arguments.length>1?new o(e,arguments[1]):new o(e)}function s(e,t){if(e=y(e,t<0?0:0|b(t)),!o.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;r++)e[r]=0;return e}function u(e,t,r){"string"==typeof r&&""!==r||(r="utf8");var n=0|g(t,r);return e=y(e,n),e.write(t,r),e}function l(e,t){if(o.isBuffer(t))return a(e,t);if($(t))return c(e,t);if(null==t)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(t.buffer instanceof ArrayBuffer)return f(e,t);if(t instanceof ArrayBuffer)return h(e,t)}return t.length?d(e,t):p(e,t)}function a(e,t){var r=0|b(t.length);return e=y(e,r),t.copy(e,0,0,r),e}function c(e,t){var r=0|b(t.length);e=y(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e,t){var r=0|b(t.length);e=y(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function h(e,t){return o.TYPED_ARRAY_SUPPORT?(t.byteLength,e=o._augment(new Uint8Array(t))):e=f(e,new Uint8Array(t)),e}function d(e,t){var r=0|b(t.length);e=y(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function p(e,t){var r,n=0;"Buffer"===t.type&&$(t.data)&&(r=t.data,n=0|b(r.length)),e=y(e,n);for(var i=0;i<n;i+=1)e[i]=255&r[i];return e}function y(e,t){o.TYPED_ARRAY_SUPPORT?(e=o._augment(new Uint8Array(t)),e.__proto__=o.prototype):(e.length=t,e._isBuffer=!0);var r=0!==t&&t<=o.poolSize>>>1;return r&&(e.parent=W),e}function b(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function v(e,t){if(!(this instanceof v))return new v(e,t);var r=new o(e,t);return delete r.parent,r}function g(e,t){"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"binary":case"raw":case"raws":return r;case"utf8":case"utf-8":return M(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return F(e).length;default:if(n)return M(e).length;t=(""+t).toLowerCase(),n=!0}}function w(e,t,r){var n=!1;if(t=0|t,r=void 0===r||r===1/0?this.length:0|r,e||(e="utf8"),t<0&&(t=0),r>this.length&&(r=this.length),r<=t)return"";for(;;)switch(e){case"hex":return B(this,t,r);case"utf8":case"utf-8":return x(this,t,r);case"ascii":return q(this,t,r);case"binary":return S(this,t,r);case"base64":return I(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function z(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;var o=t.length;if(o%2!==0)throw new Error("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;s++){var u=parseInt(t.substr(2*s,2),16);if(isNaN(u))throw new Error("Invalid hex string");e[r+s]=u}return s}function m(e,t,r,n){return J(M(t,e.length-r),e,r,n)}function _(e,t,r,n){return J(Y(t),e,r,n)}function k(e,t,r,n){return _(e,t,r,n)}function E(e,t,r,n){return J(F(t),e,r,n)}function A(e,t,r,n){return J(H(t,e.length-r),e,r,n)}function I(e,t,r){return 0===t&&r===e.length?V.fromByteArray(e):V.fromByteArray(e.slice(t,r))}function x(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o=e[i],s=null,u=o>239?4:o>223?3:o>191?2:1;if(i+u<=r){var l,a,c,f;switch(u){case 1:o<128&&(s=o);break;case 2:l=e[i+1],128===(192&l)&&(f=(31&o)<<6|63&l,f>127&&(s=f));break;case 3:l=e[i+1],a=e[i+2],128===(192&l)&&128===(192&a)&&(f=(15&o)<<12|(63&l)<<6|63&a,f>2047&&(f<55296||f>57343)&&(s=f));break;case 4:l=e[i+1],a=e[i+2],c=e[i+3],128===(192&l)&&128===(192&a)&&128===(192&c)&&(f=(15&o)<<18|(63&l)<<12|(63&a)<<6|63&c,f>65535&&f<1114112&&(s=f))}}null===s?(s=65533,u=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=u}return R(n)}function R(e){var t=e.length;if(t<=Z)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=Z));return r}function q(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;i++)n+=String.fromCharCode(127&e[i]);return n}function S(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;i++)n+=String.fromCharCode(e[i]);return n}function B(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;o++)i+=N(e[o]);return i}function P(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function O(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function j(e,t,r,n,i,s){if(!o.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");if(t>i||t<s)throw new RangeError("value is out of bounds");if(r+n>e.length)throw new RangeError("index out of range")}function T(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;i++)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function U(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;i++)e[r+i]=t>>>8*(n?i:3-i)&255}function D(e,t,r,n,i,o){if(t>i||t<o)throw new RangeError("value is out of bounds");if(r+n>e.length)throw new RangeError("index out of range");if(r<0)throw new RangeError("index out of range")}function Q(e,t,r,n,i){return i||D(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),G.write(e,t,r,n,23,4),r+4}function C(e,t,r,n,i){return i||D(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),G.write(e,t,r,n,52,8),r+8}function L(e){if(e=K(e).replace(ee,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function K(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function N(e){return e<16?"0"+e.toString(16):e.toString(16)}function M(e,t){t=t||1/0;for(var r,n=e.length,i=null,o=[],s=0;s<n;s++){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Y(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t}function H(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);s++)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}function F(e){return V.toByteArray(L(e))}function J(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);i++)t[i+r]=e[i];return i}var V=r(7),G=r(8),$=r(9);t.Buffer=o,t.SlowBuffer=v,t.INSPECT_MAX_BYTES=50,o.poolSize=8192;var W={};o.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:n(),o.TYPED_ARRAY_SUPPORT?(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array):(o.prototype.length=void 0,o.prototype.parent=void 0),o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s&&e[i]===t[i];)++i;return i!==s&&(r=e[i],n=t[i]),r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!$(e))throw new TypeError("list argument must be an Array of Buffers.");if(0===e.length)return new o(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;r++)t+=e[r].length;var n=new o(t),i=0;for(r=0;r<e.length;r++){var s=e[r];s.copy(n,i),i+=s.length}return n},o.byteLength=g,o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?x(this,0,e):w.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?0:o.compare(this,e)},o.prototype.indexOf=function(e,t){function r(e,t,r){for(var n=-1,i=0;r+i<e.length;i++)if(e[r+i]===t[n===-1?0:i-n]){if(n===-1&&(n=i),i-n+1===t.length)return r+n}else n=-1;return-1}if(t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t>>=0,0===this.length)return-1;if(t>=this.length)return-1;if(t<0&&(t=Math.max(this.length+t,0)),"string"==typeof e)return 0===e.length?-1:String.prototype.indexOf.call(this,e,t);if(o.isBuffer(e))return r(this,e,t);if("number"==typeof e)return o.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,e,t):r(this,[e],t);throw new TypeError("val must be string, number or Buffer")},o.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},o.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t=0|t,isFinite(r)?(r=0|r,void 0===n&&(n="utf8")):(n=r,r=void 0);else{var i=n;n=t,t=0|r,r=i}var o=this.length-t;if((void 0===r||r>o)&&(r=o),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return z(this,e,t,r);case"utf8":case"utf-8":return m(this,e,t,r);case"ascii":return _(this,e,t,r);case"binary":return k(this,e,t,r);case"base64":return E(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),t<e&&(t=e);var n;if(o.TYPED_ARRAY_SUPPORT)n=o._augment(this.subarray(e,t));else{var i=t-e;n=new o(i,(void 0));for(var s=0;s<i;s++)n[s]=this[s+e]}return n.length&&(n.parent=this.parent||this),n},o.prototype.readUIntLE=function(e,t,r){e=0|e,t=0|t,r||O(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},o.prototype.readUIntBE=function(e,t,r){e=0|e,t=0|t,r||O(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return t||O(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||O(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||O(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e=0|e,t=0|t,r||O(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e=0|e,t=0|t,r||O(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||O(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},o.prototype.readInt16LE=function(e,t){t||O(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){t||O(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||O(e,4,this.length),G.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||O(e,4,this.length),G.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||O(e,8,this.length),G.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||O(e,8,this.length),G.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){e=+e,t=0|t,r=0|r,n||j(this,e,t,r,Math.pow(2,8*r),0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){e=+e,t=0|t,r=0|r,n||j(this,e,t,r,Math.pow(2,8*r),0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e=+e,t=0|t,r||j(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t=0|t,r||j(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):T(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t=0|t,r||j(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):T(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t=0|t,r||j(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):U(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t=0|t,r||j(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t=0|t,!n){var i=Math.pow(2,8*r-1);j(this,e,t,r,i-1,-i)}var o=0,s=1,u=e<0?1:0;for(this[t]=255&e;++o<r&&(s*=256);)this[t+o]=(e/s>>0)-u&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t=0|t,!n){var i=Math.pow(2,8*r-1);j(this,e,t,r,i-1,-i)}var o=r-1,s=1,u=e<0?1:0;for(this[t+o]=255&e;--o>=0&&(s*=256);)this[t+o]=(e/s>>0)-u&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t=0|t,r||j(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t=0|t,r||j(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):T(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t=0|t,r||j(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):T(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t=0|t,r||j(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):U(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t=0|t,r||j(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,r){return Q(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return Q(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return C(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return C(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,s=n-r;if(this===e&&r<t&&t<n)for(i=s-1;i>=0;i--)e[i+t]=this[i+r];else if(s<1e3||!o.TYPED_ARRAY_SUPPORT)for(i=0;i<s;i++)e[i+t]=this[i+r];else e._set(this.subarray(r,r+s),t);return s},o.prototype.fill=function(e,t,r){if(e||(e=0),t||(t=0),r||(r=this.length),r<t)throw new RangeError("end < start");if(r!==t&&0!==this.length){if(t<0||t>=this.length)throw new RangeError("start out of bounds");if(r<0||r>this.length)throw new RangeError("end out of bounds");var n;if("number"==typeof e)for(n=t;n<r;n++)this[n]=e;else{var i=M(e.toString()),o=i.length;for(n=t;n<r;n++)this[n]=i[n%o]}return this}},o.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(o.TYPED_ARRAY_SUPPORT)return new o(this).buffer;for(var e=new Uint8Array(this.length),t=0,r=e.length;t<r;t+=1)e[t]=this[t];return e.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var X=o.prototype;o._augment=function(e){return e.constructor=o,e._isBuffer=!0,e._set=e.set,e.get=X.get,e.set=X.set,e.write=X.write,e.toString=X.toString,e.toLocaleString=X.toString,e.toJSON=X.toJSON,e.equals=X.equals,e.compare=X.compare,e.indexOf=X.indexOf,e.copy=X.copy,e.slice=X.slice,e.readUIntLE=X.readUIntLE,e.readUIntBE=X.readUIntBE,e.readUInt8=X.readUInt8,e.readUInt16LE=X.readUInt16LE,e.readUInt16BE=X.readUInt16BE,e.readUInt32LE=X.readUInt32LE,e.readUInt32BE=X.readUInt32BE,e.readIntLE=X.readIntLE,e.readIntBE=X.readIntBE,e.readInt8=X.readInt8,e.readInt16LE=X.readInt16LE,e.readInt16BE=X.readInt16BE,e.readInt32LE=X.readInt32LE,e.readInt32BE=X.readInt32BE,e.readFloatLE=X.readFloatLE,e.readFloatBE=X.readFloatBE,e.readDoubleLE=X.readDoubleLE,e.readDoubleBE=X.readDoubleBE,e.writeUInt8=X.writeUInt8,e.writeUIntLE=X.writeUIntLE,e.writeUIntBE=X.writeUIntBE,e.writeUInt16LE=X.writeUInt16LE,e.writeUInt16BE=X.writeUInt16BE,e.writeUInt32LE=X.writeUInt32LE,e.writeUInt32BE=X.writeUInt32BE,e.writeIntLE=X.writeIntLE,e.writeIntBE=X.writeIntBE,e.writeInt8=X.writeInt8,e.writeInt16LE=X.writeInt16LE,e.writeInt16BE=X.writeInt16BE,e.writeInt32LE=X.writeInt32LE,e.writeInt32BE=X.writeInt32BE,e.writeFloatLE=X.writeFloatLE,e.writeFloatBE=X.writeFloatBE,e.writeDoubleLE=X.writeDoubleLE,e.writeDoubleBE=X.writeDoubleBE,e.fill=X.fill,e.inspect=X.inspect,e.toArrayBuffer=X.toArrayBuffer,e};var ee=/[^+\/0-9A-Za-z-_]/g},function(e,t,r){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(e){"use strict";function t(e){var t=e.charCodeAt(0);return t===s||t===f?62:t===u||t===h?63:t<l?-1:t<l+10?t-l+26+26:t<c+26?t-c:t<a+26?t-a+26:void 0}function r(e){function r(e){a[f++]=e}var n,i,s,u,l,a;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c=e.length;l="="===e.charAt(c-2)?2:"="===e.charAt(c-1)?1:0,a=new o(3*e.length/4-l),s=l>0?e.length-4:e.length;var f=0;for(n=0,i=0;n<s;n+=4,i+=3)u=t(e.charAt(n))<<18|t(e.charAt(n+1))<<12|t(e.charAt(n+2))<<6|t(e.charAt(n+3)),r((16711680&u)>>16),r((65280&u)>>8),r(255&u);return 2===l?(u=t(e.charAt(n))<<2|t(e.charAt(n+1))>>4,r(255&u)):1===l&&(u=t(e.charAt(n))<<10|t(e.charAt(n+1))<<4|t(e.charAt(n+2))>>2,r(u>>8&255),r(255&u)),a}function i(e){function t(e){return n.charAt(e)}function r(e){return t(e>>18&63)+t(e>>12&63)+t(e>>6&63)+t(63&e)}var i,o,s,u=e.length%3,l="";for(i=0,s=e.length-u;i<s;i+=3)o=(e[i]<<16)+(e[i+1]<<8)+e[i+2],l+=r(o);switch(u){case 1:o=e[e.length-1],l+=t(o>>2),l+=t(o<<4&63),l+="==";break;case 2:o=(e[e.length-2]<<8)+e[e.length-1],l+=t(o>>10),l+=t(o>>4&63),l+=t(o<<2&63),l+="="}return l}var o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="+".charCodeAt(0),u="/".charCodeAt(0),l="0".charCodeAt(0),a="a".charCodeAt(0),c="A".charCodeAt(0),f="-".charCodeAt(0),h="_".charCodeAt(0);e.toByteArray=r,e.fromByteArray=i}(t)},function(e,t){t.read=function(e,t,r,n,i){var o,s,u=8*i-n-1,l=(1<<u)-1,a=l>>1,c=-7,f=r?i-1:0,h=r?-1:1,d=e[t+f];for(f+=h,o=d&(1<<-c)-1,d>>=-c,c+=u;c>0;o=256*o+e[t+f],f+=h,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;c>0;s=256*s+e[t+f],f+=h,c-=8);if(0===o)o=1-a;else{if(o===l)return s?NaN:(d?-1:1)*(1/0);s+=Math.pow(2,n),o-=a}return(d?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var s,u,l,a=8*o-i-1,c=(1<<a)-1,f=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(u=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),t+=s+f>=1?h/l:h*Math.pow(2,1-f),t*l>=2&&(s++,l/=2),s+f>=c?(u=0,s=c):s+f>=1?(u=(t*l-1)*Math.pow(2,i),s+=f):(u=t*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;e[r+d]=255&u,d+=p,u/=256,i-=8);for(s=s<<i|u,a+=i;a>0;e[r+d]=255&s,d+=p,s/=256,a-=8);e[r+d-p]|=128*y}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){function n(e,t){if(!(this instanceof n))return new n(e,t);this._opad=u,this._alg=e;var r="sha512"===e?128:64;t=this._key=Buffer.isBuffer(t)?t:new Buffer(t),t.length>r?t=i(e).update(t).digest():t.length<r&&(t=Buffer.concat([t,o],r));for(var s=this._ipad=new Buffer(r),u=this._opad=new Buffer(r),l=0;l<r;l++)s[l]=54^t[l],u[l]=92^t[l];this._hash=i(e).update(s)}var i=r(4),o=new Buffer(128);o.fill(0),e.exports=n,n.prototype.update=function(e,t){return this._hash.update(e,t),this},n.prototype.digest=function(e){var t=this._hash.digest();return i(this._alg).update(this._opad).update(t).digest(e)}},function(e,t){function r(e,t){if(e.length%o!==0){var r=e.length+(o-e.length%o);e=Buffer.concat([e,s],r)}for(var n=[],i=t?e.readInt32BE:e.readInt32LE,u=0;u<e.length;u+=o)n.push(i.call(e,u));return n}function n(e,t,r){for(var n=new Buffer(t),i=r?n.writeInt32BE:n.writeInt32LE,o=0;o<e.length;o++)i.call(n,e[o],4*o,!0);return n}function i(e,t,i,o){Buffer.isBuffer(e)||(e=new Buffer(e));var s=t(r(e,o),e.length*u);return n(s,i,o)}var o=4,s=new Buffer(o);s.fill(0);var u=8;e.exports={hash:i}},function(e,t,r){function n(){var e=[].slice.call(arguments).join(" ");throw new Error([e,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}function i(e,t){for(var r in e)t(e[r],r)}var o=r(22);t.createHash=r(4),t.createHmac=r(10),t.randomBytes=function(e,t){if(!t||!t.call)return new Buffer(o(e));try{t.call(this,void 0,new Buffer(o(e)))}catch(r){t(r)}},t.getHashes=function(){return["sha1","sha256","sha512","md5","rmd160"]};var s=r(21)(t);t.pbkdf2=s.pbkdf2,t.pbkdf2Sync=s.pbkdf2Sync,i(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman"],function(e){t[e]=function(){n("sorry,",e,"is not implemented yet")}})},function(e,t,r){function n(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var r=1732584193,n=-271733879,i=-1732584194,c=271733878,f=0;f<e.length;f+=16){var h=r,d=n,p=i,y=c;r=o(r,n,i,c,e[f+0],7,-680876936),c=o(c,r,n,i,e[f+1],12,-389564586),i=o(i,c,r,n,e[f+2],17,606105819),n=o(n,i,c,r,e[f+3],22,-1044525330),r=o(r,n,i,c,e[f+4],7,-176418897),c=o(c,r,n,i,e[f+5],12,1200080426),i=o(i,c,r,n,e[f+6],17,-1473231341),n=o(n,i,c,r,e[f+7],22,-45705983),r=o(r,n,i,c,e[f+8],7,1770035416),c=o(c,r,n,i,e[f+9],12,-1958414417),i=o(i,c,r,n,e[f+10],17,-42063),n=o(n,i,c,r,e[f+11],22,-1990404162),r=o(r,n,i,c,e[f+12],7,1804603682),c=o(c,r,n,i,e[f+13],12,-40341101),i=o(i,c,r,n,e[f+14],17,-1502002290),n=o(n,i,c,r,e[f+15],22,1236535329),r=s(r,n,i,c,e[f+1],5,-165796510),c=s(c,r,n,i,e[f+6],9,-1069501632),i=s(i,c,r,n,e[f+11],14,643717713),n=s(n,i,c,r,e[f+0],20,-373897302),r=s(r,n,i,c,e[f+5],5,-701558691),c=s(c,r,n,i,e[f+10],9,38016083),i=s(i,c,r,n,e[f+15],14,-660478335),n=s(n,i,c,r,e[f+4],20,-405537848),r=s(r,n,i,c,e[f+9],5,568446438),c=s(c,r,n,i,e[f+14],9,-1019803690),i=s(i,c,r,n,e[f+3],14,-187363961),n=s(n,i,c,r,e[f+8],20,1163531501),r=s(r,n,i,c,e[f+13],5,-1444681467),c=s(c,r,n,i,e[f+2],9,-51403784),i=s(i,c,r,n,e[f+7],14,1735328473),n=s(n,i,c,r,e[f+12],20,-1926607734),r=u(r,n,i,c,e[f+5],4,-378558),c=u(c,r,n,i,e[f+8],11,-2022574463),i=u(i,c,r,n,e[f+11],16,1839030562),n=u(n,i,c,r,e[f+14],23,-35309556),r=u(r,n,i,c,e[f+1],4,-1530992060),c=u(c,r,n,i,e[f+4],11,1272893353),i=u(i,c,r,n,e[f+7],16,-155497632),n=u(n,i,c,r,e[f+10],23,-1094730640),r=u(r,n,i,c,e[f+13],4,681279174),c=u(c,r,n,i,e[f+0],11,-358537222),i=u(i,c,r,n,e[f+3],16,-722521979),n=u(n,i,c,r,e[f+6],23,76029189),r=u(r,n,i,c,e[f+9],4,-640364487),c=u(c,r,n,i,e[f+12],11,-421815835),i=u(i,c,r,n,e[f+15],16,530742520),n=u(n,i,c,r,e[f+2],23,-995338651),r=l(r,n,i,c,e[f+0],6,-198630844),c=l(c,r,n,i,e[f+7],10,1126891415),i=l(i,c,r,n,e[f+14],15,-1416354905),n=l(n,i,c,r,e[f+5],21,-57434055),r=l(r,n,i,c,e[f+12],6,1700485571),c=l(c,r,n,i,e[f+3],10,-1894986606),i=l(i,c,r,n,e[f+10],15,-1051523),n=l(n,i,c,r,e[f+1],21,-2054922799),r=l(r,n,i,c,e[f+8],6,1873313359),c=l(c,r,n,i,e[f+15],10,-30611744),i=l(i,c,r,n,e[f+6],15,-1560198380),n=l(n,i,c,r,e[f+13],21,1309151649),r=l(r,n,i,c,e[f+4],6,-145523070),c=l(c,r,n,i,e[f+11],10,-1120210379),i=l(i,c,r,n,e[f+2],15,718787259),n=l(n,i,c,r,e[f+9],21,-343485551),r=a(r,h),n=a(n,d),i=a(i,p),c=a(c,y)}return Array(r,n,i,c)}function i(e,t,r,n,i,o){return a(c(a(a(t,e),a(n,o)),i),r)}function o(e,t,r,n,o,s,u){return i(t&r|~t&n,e,t,o,s,u)}function s(e,t,r,n,o,s,u){return i(t&n|r&~n,e,t,o,s,u)}function u(e,t,r,n,o,s,u){return i(t^r^n,e,t,o,s,u)}function l(e,t,r,n,o,s,u){return i(r^(t|~n),e,t,o,s,u)}function a(e,t){var r=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(r>>16);return n<<16|65535&r}function c(e,t){return e<<t|e>>>32-t}var f=r(11);e.exports=function(e){return f.hash(e,n,16)}},function(e,t){e.exports=function(e){function t(e,t,n,i,o,s){if("function"==typeof o&&(s=o,o=void 0),"function"!=typeof s)throw new Error("No callback provided to pbkdf2");setTimeout(function(){var u;try{u=r(e,t,n,i,o)}catch(l){return s(l)}s(void 0,u)})}function r(t,r,n,i,o){if("number"!=typeof n)throw new TypeError("Iterations not a number");if(n<0)throw new TypeError("Bad iterations");if("number"!=typeof i)throw new TypeError("Key length not a number");if(i<0)throw new TypeError("Bad key length");o=o||"sha1",Buffer.isBuffer(t)||(t=new Buffer(t)),Buffer.isBuffer(r)||(r=new Buffer(r));var s,u,l,a=1,c=new Buffer(i),f=new Buffer(r.length+4);r.copy(f,0,0,r.length);for(var h=1;h<=a;h++){f.writeUInt32BE(h,r.length);var d=e.createHmac(o,t).update(f).digest();if(!s&&(s=d.length,l=new Buffer(s),a=Math.ceil(i/s),u=i-(a-1)*s,i>(Math.pow(2,32)-1)*s))throw new TypeError("keylen exceeds maximum length");d.copy(l,0,0,s);for(var p=1;p<n;p++){d=e.createHmac(o,t).update(d).digest();for(var y=0;y<s;y++)l[y]^=d[y]}var b=(h-1)*s,v=h==a?u:s;l.copy(c,b,0,v)}return c}return{pbkdf2:t,pbkdf2Sync:r}}},function(e,t){function r(e,t,r){return e^t^r}function n(e,t,r){return e&t|~e&r}function i(e,t,r){return(e|~t)^r}function o(e,t,r){return e&r|t&~r}function s(e,t,r){return e^(t|~r)}function u(e,t){return e<<t|e>>>32-t}function l(e){var t=[1732584193,4023233417,2562383102,271733878,3285377520];"string"==typeof e&&(e=new Buffer(e,"utf8"));var r=y(e),n=8*e.length,i=8*e.length;r[n>>>5]|=128<<24-n%32,r[(n+64>>>9<<4)+14]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);for(var o=0;o<r.length;o+=16)v(t,r,o);for(var o=0;o<5;o++){var s=t[o];t[o]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var u=b(t);return new Buffer(u)}e.exports=l;/** @preserve
	(c) 2012 by Cédric Mesnil. All rights reserved.
	
	Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
	
	    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
	    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
	
	THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/
var a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],c=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],f=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],h=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],d=[0,1518500249,1859775393,2400959708,2840853838],p=[1352829926,1548603684,1836072691,2053994217,0],y=function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},b=function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},v=function(e,t,l){for(var y=0;y<16;y++){var b=l+y,v=t[b];t[b]=16711935&(v<<8|v>>>24)|4278255360&(v<<24|v>>>8)}var g,w,z,m,_,k,E,A,I,x;k=g=e[0],E=w=e[1],A=z=e[2],I=m=e[3],x=_=e[4];for(var R,y=0;y<80;y+=1)R=g+t[l+a[y]]|0,R+=y<16?r(w,z,m)+d[0]:y<32?n(w,z,m)+d[1]:y<48?i(w,z,m)+d[2]:y<64?o(w,z,m)+d[3]:s(w,z,m)+d[4],R=0|R,R=u(R,f[y]),R=R+_|0,g=_,_=m,m=u(z,10),z=w,w=R,R=k+t[l+c[y]]|0,R+=y<16?s(E,A,I)+p[0]:y<32?o(E,A,I)+p[1]:y<48?i(E,A,I)+p[2]:y<64?n(E,A,I)+p[3]:r(E,A,I)+p[4],R=0|R,R=u(R,h[y]),R=R+x|0,k=x,x=I,I=u(A,10),A=E,E=R;R=e[1]+z+I|0,e[1]=e[2]+m+x|0,e[2]=e[3]+_+k|0,e[3]=e[4]+g+E|0,e[4]=e[0]+w+A|0,e[0]=R}},function(e,t){e.exports=function(e){function t(t,r){this._block=new e(t),this._finalSize=r,this._blockSize=t,this._len=0,this._s=0}return t.prototype.init=function(){this._s=0,this._len=0},t.prototype.update=function(t,r){"string"==typeof t&&(r=r||"utf8",t=new e(t,r));for(var n=this._len+=t.length,i=this._s=this._s||0,o=0,s=this._block;i<n;){for(var u=Math.min(t.length,o+this._blockSize-i%this._blockSize),l=u-o,a=0;a<l;a++)s[i%this._blockSize+a]=t[a+o];i+=l,o+=l,i%this._blockSize===0&&this._update(s)}return this._s=i,this},t.prototype.digest=function(e){var t=8*this._len;this._block[this._len%this._blockSize]=128,this._block.fill(0,this._len%this._blockSize+1),t%(8*this._blockSize)>=8*this._finalSize&&(this._update(this._block),this._block.fill(0)),this._block.writeInt32BE(t,this._blockSize-4);var r=this._update(this._block)||this._hash();return e?r.toString(e):r},t.prototype._update=function(){throw new Error("_update must be implemented by subclass")},t}},function(e,t,r){var t=e.exports=function(e){var r=t[e];if(!r)throw new Error(e+" is not supported (we accept pull requests)");return new r},n=r(6).Buffer,i=r(16)(n);t.sha1=r(18)(n,i),t.sha256=r(19)(n,i),t.sha512=r(20)(n,i)},function(e,t,r){var n=r(1).inherits;e.exports=function(e,t){function r(){return p.length?p.pop().init():this instanceof r?(this._w=d,t.call(this,64,56),this._h=null,void this.init()):new r}function i(e,t,r,n){return e<20?t&r|~t&n:e<40?t^r^n:e<60?t&r|t&n|r&n:t^r^n}function o(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function s(e,t){return e+t|0}function u(e,t){return e<<t|e>>>32-t}var l=0,a=4,c=8,f=12,h=16,d=new("undefined"==typeof Int32Array?Array:Int32Array)(80),p=[];return n(r,t),r.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,t.prototype.init.call(this),this},r.prototype._POOL=p,r.prototype._update=function(e){var t,r,n,l,a,c,f,h,d,p;t=c=this._a,r=f=this._b,n=h=this._c,l=d=this._d,a=p=this._e;for(var y=this._w,b=0;b<80;b++){var v=y[b]=b<16?e.readInt32BE(4*b):u(y[b-3]^y[b-8]^y[b-14]^y[b-16],1),g=s(s(u(t,5),i(b,r,n,l)),s(s(a,v),o(b)));a=l,l=n,n=u(r,30),r=t,t=g}this._a=s(t,c),this._b=s(r,f),this._c=s(n,h),this._d=s(l,d),this._e=s(a,p)},r.prototype._hash=function(){p.length<100&&p.push(this);var t=new e(20);return t.writeInt32BE(0|this._a,l),t.writeInt32BE(0|this._b,a),t.writeInt32BE(0|this._c,c),t.writeInt32BE(0|this._d,f),t.writeInt32BE(0|this._e,h),t},r}},function(e,t,r){var n=r(1).inherits;e.exports=function(e,t){function r(){this.init(),this._w=d,t.call(this,64,56)}function i(e,t){return e>>>t|e<<32-t}function o(e,t){return e>>>t}function s(e,t,r){return e&t^~e&r}function u(e,t,r){return e&t^e&r^t&r}function l(e){return i(e,2)^i(e,13)^i(e,22)}function a(e){return i(e,6)^i(e,11)^i(e,25)}function c(e){return i(e,7)^i(e,18)^o(e,3)}function f(e){return i(e,17)^i(e,19)^o(e,10)}var h=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],d=new Array(64);return n(r,t),r.prototype.init=function(){return this._a=1779033703,this._b=-1150833019,this._c=1013904242,this._d=-1521486534,this._e=1359893119,this._f=-1694144372,this._g=528734635,this._h=1541459225,this._len=this._s=0,this},r.prototype._update=function(e){var t,r,n,i,o,d,p,y,b,v,g=this._w;t=0|this._a,r=0|this._b,n=0|this._c,i=0|this._d,o=0|this._e,d=0|this._f,p=0|this._g,y=0|this._h;for(var w=0;w<64;w++){var z=g[w]=w<16?e.readInt32BE(4*w):f(g[w-2])+g[w-7]+c(g[w-15])+g[w-16];b=y+a(o)+s(o,d,p)+h[w]+z,v=l(t)+u(t,r,n),y=p,p=d,d=o,o=i+b,i=n,n=r,r=t,t=b+v}this._a=t+this._a|0,this._b=r+this._b|0,this._c=n+this._c|0,this._d=i+this._d|0,this._e=o+this._e|0,this._f=d+this._f|0,this._g=p+this._g|0,this._h=y+this._h|0},r.prototype._hash=function(){var t=new e(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t},r}},function(e,t,r){var n=r(1).inherits;e.exports=function(e,t){function r(){this.init(),this._w=l,t.call(this,128,112)}function i(e,t,r){return e>>>r|t<<32-r}function o(e,t,r){return e&t^~e&r}function s(e,t,r){return e&t^e&r^t&r}var u=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],l=new Array(160);return n(r,t),r.prototype.init=function(){return this._a=1779033703,this._b=-1150833019,this._c=1013904242,this._d=-1521486534,this._e=1359893119,this._f=-1694144372,this._g=528734635,this._h=1541459225,this._al=-205731576,this._bl=-2067093701,this._cl=-23791573,this._dl=1595750129,this._el=-1377402159,this._fl=725511199,this._gl=-79577749,this._hl=327033209,this._len=this._s=0,this},r.prototype._update=function(e){var t,r,n,l,a,c,f,h,d,p,y,b,v,g,w,z,m=this._w;t=0|this._a,r=0|this._b,n=0|this._c,l=0|this._d,a=0|this._e,c=0|this._f,f=0|this._g,h=0|this._h,d=0|this._al,p=0|this._bl,y=0|this._cl,b=0|this._dl,v=0|this._el,g=0|this._fl,w=0|this._gl,z=0|this._hl;for(var _=0;_<80;_++){var k,E,A=2*_;if(_<16)k=m[A]=e.readInt32BE(4*A),E=m[A+1]=e.readInt32BE(4*A+4);else{var I=m[A-30],x=m[A-30+1],R=i(I,x,1)^i(I,x,8)^I>>>7,q=i(x,I,1)^i(x,I,8)^i(x,I,7);I=m[A-4],x=m[A-4+1];var S=i(I,x,19)^i(x,I,29)^I>>>6,B=i(x,I,19)^i(I,x,29)^i(x,I,6),P=m[A-14],O=m[A-14+1],j=m[A-32],T=m[A-32+1];E=q+O,k=R+P+(E>>>0<q>>>0?1:0),E+=B,k=k+S+(E>>>0<B>>>0?1:0),E+=T,k=k+j+(E>>>0<T>>>0?1:0),m[A]=k,m[A+1]=E}var U=s(t,r,n),D=s(d,p,y),Q=i(t,d,28)^i(d,t,2)^i(d,t,7),C=i(d,t,28)^i(t,d,2)^i(t,d,7),L=i(a,v,14)^i(a,v,18)^i(v,a,9),K=i(v,a,14)^i(v,a,18)^i(a,v,9),N=u[A],M=u[A+1],Y=o(a,c,f),H=o(v,g,w),F=z+K,J=h+L+(F>>>0<z>>>0?1:0);F+=H,J=J+Y+(F>>>0<H>>>0?1:0),F+=M,J=J+N+(F>>>0<M>>>0?1:0),F+=E,J=J+k+(F>>>0<E>>>0?1:0);var V=C+D,G=Q+U+(V>>>0<C>>>0?1:0);h=f,z=w,f=c,w=g,c=a,g=v,v=b+F|0,a=l+J+(v>>>0<b>>>0?1:0)|0,l=n,b=y,n=r,y=p,r=t,p=d,d=F+V|0,t=J+G+(d>>>0<F>>>0?1:0)|0}this._al=this._al+d|0,this._bl=this._bl+p|0,this._cl=this._cl+y|0,this._dl=this._dl+b|0,this._el=this._el+v|0,this._fl=this._fl+g|0,this._gl=this._gl+w|0,this._hl=this._hl+z|0,this._a=this._a+t+(this._al>>>0<d>>>0?1:0)|0,this._b=this._b+r+(this._bl>>>0<p>>>0?1:0)|0,this._c=this._c+n+(this._cl>>>0<y>>>0?1:0)|0,this._d=this._d+l+(this._dl>>>0<b>>>0?1:0)|0,this._e=this._e+a+(this._el>>>0<v>>>0?1:0)|0,this._f=this._f+c+(this._fl>>>0<g>>>0?1:0)|0,this._g=this._g+f+(this._gl>>>0<w>>>0?1:0)|0,this._h=this._h+h+(this._hl>>>0<z>>>0?1:0)|0},r.prototype._hash=function(){function t(e,t,n){r.writeInt32BE(e,n),r.writeInt32BE(t,n+4)}var r=new e(64);return t(this._a,this._al,0),t(this._b,this._bl,8),t(this._c,this._cl,16),t(this._d,this._dl,24),t(this._e,this._el,32),t(this._f,this._fl,40),t(this._g,this._gl,48),t(this._h,this._hl,56),r},r}},function(e,t,r){var n=r(14);e.exports=function(e,t){t=t||{};var r=n(e);return t.pbkdf2=r.pbkdf2,t.pbkdf2Sync=r.pbkdf2Sync,t}},function(e,t,r){!function(){var t=("undefined"==typeof window?global:window)||{};_crypto=t.crypto||t.msCrypto||r(37),e.exports=function(e){if(_crypto.getRandomValues){var t=new Buffer(e);return _crypto.getRandomValues(t),t}if(_crypto.randomBytes)return _crypto.randomBytes(e);throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}}()},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,r){function n(e,t,r){if(!t||!r)throw new Error("The KuzzleDataCollection object constructor needs an index and a collection arguments");return Object.defineProperties(this,{collection:{value:r,enumerable:!0},index:{value:t,enumerable:!0},kuzzle:{value:e,enumerable:!0},headers:{value:JSON.parse(JSON.stringify(e.headers)),enumerable:!0,writable:!0}}),Object.defineProperty(this,"buildQueryArgs",{value:function(e,t){return{controller:e,action:t,collection:this.collection,index:this.index}}}),this.kuzzle.bluebird?this.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["publishMessage","setHeaders","subscribe"];return n&&i.indexOf(e)===-1}}):this}var i=r(27),o=r(26),s=r(29);n.prototype.advancedSearch=function(e,t,r){var n,o=this;return r||"function"!=typeof t||(r=t,t=null),o.kuzzle.callbackRequired("KuzzleDataCollection.advancedSearch",r),n=o.kuzzle.addHeaders({body:e},this.headers),o.kuzzle.query(this.buildQueryArgs("read","search"),n,t,function(e,t){var n=[];return e?r(e):(t.result.hits.forEach(function(e){var t=new i(o,e._id,e._source);t.version=e._version,n.push(t)}),void r(null,{total:t.result.total,documents:n}))}),this},n.prototype.count=function(e,t,r){var n;return r||"function"!=typeof t||(r=t,t=null),this.kuzzle.callbackRequired("KuzzleDataCollection.count",r),n=this.kuzzle.addHeaders({body:e},this.headers),this.kuzzle.query(this.buildQueryArgs("read","count"),n,t,function(e,t){return e?r(e):void r(null,t.result.count)}),this},n.prototype.create=function(e,t){var r={};return t||"function"!=typeof e||(t=e,e=null),r=this.kuzzle.addHeaders(r,this.headers),this.kuzzle.query(this.buildQueryArgs("write","createCollection"),r,e,t),this},n.prototype.createDocument=function(e,t,r,n){var o=this,s={},u="create";return e&&"string"!=typeof e&&(n=r,r=t,t=e,e=null),n||"function"!=typeof r||(n=r,r=null),t instanceof i?s=t.serialize():s.body=t,r&&(u=r.updateIfExist?"createOrReplace":"create"),e&&(s._id=e),s=o.kuzzle.addHeaders(s,o.headers),n?o.kuzzle.query(this.buildQueryArgs("write",u),s,r,function(e,t){var r;return e?n(e):(r=new i(o,t.result._id,t.result._source),r.version=t.result._version,void n(null,r))}):o.kuzzle.query(this.buildQueryArgs("write",u),s,r),this},n.prototype.deleteDocument=function(e,t,r){var n,i={};"string"==typeof e?(i._id=e,n="delete"):(i.body=e,n="deleteByQuery"),r||"function"!=typeof t||(r=t,t=null),i=this.kuzzle.addHeaders(i,this.headers),r?this.kuzzle.query(this.buildQueryArgs("write",n),i,t,function(e,t){return e?r(e):void("delete"===n?r(null,[t.result._id]):r(null,t.result.ids))}):this.kuzzle.query(this.buildQueryArgs("write",n),i,t)},n.prototype.fetchDocument=function(e,t,r){var n={_id:e},o=this;return r||"function"!=typeof t||(r=t,t=null),o.kuzzle.callbackRequired("KuzzleDataCollection.fetch",r),n=o.kuzzle.addHeaders(n,this.headers),o.kuzzle.query(this.buildQueryArgs("read","get"),n,t,function(e,t){var n;return e?r(e):(n=new i(o,t.result._id,t.result._source),n.version=t.result._version,void r(null,n))}),this},n.prototype.fetchAllDocuments=function(e,t){var r={};return t||"function"!=typeof e||(t=e,e=null),e&&(e.from&&(r.from=e.from),e.size&&(r.size=e.size)),this.kuzzle.callbackRequired("KuzzleDataCollection.fetchAll",t),this.advancedSearch(r,e,t),this},n.prototype.getMapping=function(e,t){var r;return t||"function"!=typeof e||(t=e,e=null),this.kuzzle.callbackRequired("KuzzleDataCollection.getMapping",t),r=new o(this),r.refresh(e,t),this},n.prototype.publishMessage=function(e,t,r){var n={};return e instanceof i?n=e.serialize():n.body=e,n=this.kuzzle.addHeaders(n,this.headers),this.kuzzle.query(this.buildQueryArgs("write","publish"),n,t,r),this},n.prototype.replaceDocument=function(e,t,r,n){var o=this,s={_id:e,body:t};return n||"function"!=typeof r||(n=r,r=null),s=o.kuzzle.addHeaders(s,this.headers),n?o.kuzzle.query(this.buildQueryArgs("write","createOrReplace"),s,r,function(e,t){var r;return e?n(e):(r=new i(o,t.result._id,t.result._source),r.version=t.result._version,void n(null,r))}):o.kuzzle.query(this.buildQueryArgs("write","createOrReplace"),s,r),this},n.prototype.subscribe=function(e,t,r){var n;return r||"function"!=typeof t||(r=t,t=null),this.kuzzle.callbackRequired("KuzzleDataCollection.subscribe",r),n=new s(this,t),n.renew(e,r)},n.prototype.truncate=function(e,t){var r={};return t||"function"!=typeof e||(t=e,e=null),r=this.kuzzle.addHeaders(r,this.headers),this.kuzzle.query(this.buildQueryArgs("admin","truncateCollection"),r,e,t),this},n.prototype.updateDocument=function(e,t,r,n){var o={_id:e,body:t},s=this;return n||"function"!=typeof r||(n=r,r=null),o=s.kuzzle.addHeaders(o,this.headers),n?s.kuzzle.query(this.buildQueryArgs("write","update"),o,r,function(e,t){var r;return e?n(e):(r=new i(s,t.result._id),void r.refresh(n))}):s.kuzzle.query(this.buildQueryArgs("write","update"),o,r),s},n.prototype.documentFactory=function(e,t){return new i(this,e,t)},n.prototype.roomFactory=function(e){return new s(this,e)},n.prototype.dataMappingFactory=function(e){return new o(this,e)},n.prototype.setHeaders=function(e,t){return this.kuzzle.setHeaders.call(this,e,t),this},e.exports=n},function(e,t){function r(e,t){return Object.defineProperties(this,{collection:{value:e,enumerable:!0},kuzzle:{value:e.kuzzle,enumerable:!0},headers:{value:JSON.parse(JSON.stringify(e.headers)),enumerable:!0,writable:!0},mapping:{value:t||{},enumerable:!0,writable:!0}}),this.kuzzle.bluebird?this.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["set","setHeaders"];return n&&i.indexOf(e)===-1}}):this}r.prototype.apply=function(e,t){var r=this,n=this.kuzzle.addHeaders({body:{properties:this.mapping}},this.headers);return t||"function"!=typeof e||(t=e,e=null),r.kuzzle.query(this.collection.buildQueryArgs("admin","updateMapping"),n,e,function(n){return n?!!t&&t(n):void r.refresh(e,t)}),this},r.prototype.refresh=function(e,t){var r=this,n=this.kuzzle.addHeaders({},this.headers);return t||"function"!=typeof e||(t=e,e=null),this.kuzzle.query(this.collection.buildQueryArgs("admin","getMapping"),n,e,function(e,n){return e?!!t&&t(e):n.result[r.collection.index]?n.result[r.collection.index].mappings[r.collection.collection]?(r.mapping=n.result[r.collection.index].mappings[r.collection.collection].properties,void 0===r.mapping&&(r.mapping={}),void(t&&t(null,r))):!!t&&t(new Error("No mapping found for collection "+r.collection.collection)):!!t&&t(new Error("No mapping found for index "+r.collection.index))}),this},r.prototype.set=function(e,t){return this.mapping[e]=t,this},r.prototype.setHeaders=function(e,t){return this.kuzzle.setHeaders.call(this,e,t),this},e.exports=r},function(e,t){function r(e,t,r){return Object.defineProperties(this,{collection:{value:e.collection,enumerable:!0},dataCollection:{value:e,enumerable:!0},kuzzle:{value:e.kuzzle,enumerable:!0},id:{value:void 0,enumerable:!0,writable:!0},content:{value:{},writable:!0,enumerable:!0},headers:{value:JSON.parse(JSON.stringify(e.headers)),enumerable:!0,writable:!0},version:{value:void 0,enumerable:!0,writable:!0}}),!r&&t&&"object"==typeof t&&(r=t,t=null),r&&(r._version&&(this.version=r._version,delete r._version),this.setContent(r,!0)),t&&Object.defineProperty(this,"id",{value:t,enumerable:!0}),this.kuzzle.bluebird?this.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["delete","refresh","save"];return n&&i.indexOf(e)!==-1}}):this}r.prototype.serialize=function(){var e={};return this.id&&(e._id=this.id),e.body=this.content,e._version=this.version,e=this.kuzzle.addHeaders(e,this.headers)},r.prototype.toString=function(){return JSON.stringify(this.serialize())},r.prototype["delete"]=function(e,t){var r=this;if(t||"function"!=typeof e||(t=e,e=null),!r.id)throw new Error("KuzzleDocument.delete: cannot delete a document without a document ID");t?this.kuzzle.query(this.dataCollection.buildQueryArgs("write","delete"),this.serialize(),e,function(e){return e?t(e):void t(null,r.id)}):this.kuzzle.query(this.dataCollection.buildQueryArgs("write","delete"),this.serialize(),e)},r.prototype.refresh=function(e,t){var n=this;if(t||"function"!=typeof e||(t=e,e=null),!n.id)throw new Error("KuzzleDocument.refresh: cannot retrieve a document if no ID has been provided");this.kuzzle.callbackRequired("KuzzleDocument.refresh",t),n.kuzzle.query(n.dataCollection.buildQueryArgs("read","get"),{_id:n.id},e,function(e,i){var o;return e?t(e):(o=new r(n.dataCollection,n.id,i.result._source),o.version=i.result._version,void t(null,o))})},r.prototype.save=function(e,t){var r=this.serialize(),n=this;return e&&void 0===t&&"function"==typeof e&&(t=e,e=null),n.kuzzle.query(this.dataCollection.buildQueryArgs("write","createOrReplace"),r,e,function(e,r){return e?!!t&&t(e):(n.id=r.result._id,n.version=r.result._version,void(t&&t(null,n)))}),n},r.prototype.publish=function(e){var t=this.serialize();return this.kuzzle.query(this.dataCollection.buildQueryArgs("write","publish"),t,e),this},r.prototype.setContent=function(e,t){var r=this;return t?this.content=e:Object.keys(e).forEach(function(t){r.content[t]=e[t]}),this},r.prototype.subscribe=function(e,t){var r;if(e&&!t&&"function"==typeof e&&(t=e,e=null),this.kuzzle.callbackRequired("KuzzleDocument.subscribe",t),!this.id)throw new Error("KuzzleDocument.subscribe: cannot subscribe to a document if no ID has been provided");return r={ids:{values:[this.id]}},this.dataCollection.subscribe(r,e,t)},r.prototype.setHeaders=function(e,t){return this.kuzzle.setHeaders.call(this,e,t),this},e.exports=r},function(e,t){function r(e){return Object.defineProperties(this,{kuzzle:{value:e,enumerable:!0},headers:{value:JSON.parse(JSON.stringify(e.headers)),enumerable:!0,writable:!0}}),this.setHeaders=e.setHeaders.bind(this),this.kuzzle.bluebird?this.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["setHeaders"];return n&&i.indexOf(e)===-1}}):this}!function(){var e=["id","value"],t=["id","keys"],n={append:e,bgrewriteaof:[],bgsave:[],bitcount:["id","start","end"],bitop:["operation","destkey",t],bitpos:["id","bit",{__opts__:["start","end"]}],blpop:[t,"timeout"],brpoplpush:["source","destination"],dbsize:[],decrby:e,del:[t],discard:[],exec:[],exists:[t],expire:["id","seconds"],expireat:["id","timestamp"],flushdb:[],getbit:["id","offset"],getrange:["id","start","end"],hdel:["id",["field","fields"]],hexists:["id","field"],hincrby:["id","field","value"],hmset:["id","values"],hset:["id","field","value"],info:["section"],keys:["pattern"],lastsave:[],lindex:["id","idx"],linsert:["id","position","pivot","value"],lpush:["id",["value","values"]],lrange:["id","start","stop"],lrem:["id","count","value"],lset:["id","idx","value"],ltrim:["id","start","stop"],mset:["values"],multi:[],object:["subcommand","args"],pexpire:["id","milliseconds"],pexpireat:["id","timestamp"],pfadd:["id",["element","elements"]],pfmerge:["destkey",["sourcekey","sourcekeys"]],ping:[],psetex:["id","milliseconds","value"],publish:["channel","message"],randomkey:[],rename:["id","newkey"],renamenx:["id","newkey"],restore:["id","ttl","content"],rpoplpush:["source","destination"],sadd:["id",["member","members"]],save:[],set:["id","value",{__opts__:["ex","px","nx","xx"]}],sdiffstore:["destination",t],setbit:["id","offset","value"],setex:["id","seconds","value"],setrange:["id","offset","value"],sinterstore:["destination",t],sismember:["id","member"],smove:["id","destination","member"],sort:["id",{__opts__:["by","offset","count","get","direction","alpha","store"]}],spop:["id","count"],srem:["id",["member","members"]],sunionstore:["destination",t],unwatch:[],wait:["numslaves","timeout"],zadd:["id",{__opts__:["nx","xx","ch","incr","score","member","members"]}],zcount:["id","min","max"],zincrby:["id","value","member"],zinterstore:["destination",t,{__opts__:["weight","weights","aggregate"]}],zlexcount:["id","min","max"],zrange:["id","start","stop",{__opts__:["withscores"]}],zrangebylex:["id","min","max",{__opts__:["offset","count"]}],zrangebyscore:["id","min","max",{__opts__:["withscores","offset","count"]}],zrem:["id","member"],zremrangebylex:["id","min","max"],zremrangebyscore:["id","min","max"],zrevrangebylex:["id","max","min",{__opts__:["offset","count"]}],zrevrangebyscore:["id","max","min",{__opts__:["withscores","offset","count"]}],zrevrank:["id","member"]};n.decr=n.get=n.dump=n.hgetall=n.hkeys=n.hlen=n.hstrlen=n.hvals=n.incr=n.llen=n.lpop=n.persist=n.pttl=n.rpop=n.scard=n.smembers=n.strlen=n.ttl=n.type=n.zcard=["id"],n.getset=n.lpushx=e,n.del=n.exists=n.mget=n.pfcount=n.sdiff=n.sinter=n.sunion=n.watch=[t],n.incrby=n.incrbyfloat=n.decrby,n.brpop=n.blpop,n.hget=n.hexists,n.hmget=n.hdel,n.hsetnx=n.hset,n.msetnx=n.mset,n.rpush=n.lpush,n.hincrbyfloat=n.hincrby,n.srandmember=n.spop,n.zrevrange=n.zrange,n.zscore=n.zrevrank,Object.keys(n).forEach(function(e){r.prototype[e]=function(){var t,r=Array.prototype.slice.call(arguments),i=null,o={controller:"ms",action:e},s={};return"function"==typeof r[r.length-1]&&(t=r.pop()),r.length&&"object"==typeof r[r.length-1]&&1===Object.keys(r[r.length-1]).length&&void 0!==r[r.length-1].queuable&&(i=r.pop()),n[e].forEach(function(e,t){void 0!==r[t]&&(Array.isArray(e)&&(e=Array.isArray(r[t])?e[1]:e[0]),"id"===e?s._id=r[t]:(s.body||(s.body={}),"object"==typeof e&&void 0!==e.__opts__?e.__opts__.forEach(function(e){void 0!==r[t][e]&&(s.body[e]=r[t][e])}):s.body[e]=r[t]))}),this.kuzzle.query(o,s,i,t),this}})}(),e.exports=r},function(e,t,r){function n(e,t){return Object.defineProperties(this,{callback:{value:null,writable:!0},channel:{value:null,writable:!0},id:{value:u.v4()},lastRenewal:{value:null,writable:!0},notifier:{value:null,writable:!0},queue:{value:[],writable:!0},renewalDelay:{value:500},scope:{value:t&&t.scope?t.scope:"all"},state:{value:t&&t.state?t.state:"done"},subscribing:{value:!1,writable:!0},users:{value:t&&t.users?t.users:"none"},collection:{value:e,enumerable:!0},kuzzle:{value:e.kuzzle,enumerable:!0},filters:{value:null,enumerable:!0,writable:!0},headers:{value:JSON.parse(JSON.stringify(e.headers)),enumerable:!0,writable:!0},metadata:{value:t&&t.metadata?t.metadata:{},enumerable:!0,writable:!0},roomId:{value:null,enumerable:!0,writable:!0},subscribeToSelf:{value:!t||"boolean"!=typeof t.subscribeToSelf||t.subscribeToSelf,enumerable:!0,writable:!0}}),this.kuzzle.bluebird?this.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["count"];return n&&i.indexOf(e)!==-1}}):this}function i(e){return e.error?this.callback(e.error):"jwtTokenExpired"===e.action?(this.kuzzle.jwtToken=void 0,this.kuzzle.emitEvent("jwtTokenExpired")):void(this.kuzzle.requestHistory[e.requestId]?(this.subscribeToSelf&&this.callback(null,e),delete this.kuzzle.requestHistory[e.requestId]):this.callback(null,e))}function o(){for(var e;this.queue.length>0;)e=this.queue.shift(),this[e.action].apply(this,e.args)}function s(){return"connected"===this.kuzzle.state&&!this.subscribing}var u=r(3);n.prototype.count=function(e){var t;if(this.kuzzle.callbackRequired("KuzzleRoom.count",e),t=this.kuzzle.addHeaders({body:{roomId:this.roomId}},this.headers),!s.call(this))return this.queue.push({action:"count",args:[e]}),this;if(!this.roomId)throw new Error("KuzzleRoom.count: cannot count subscriptions on an inactive room");return this.kuzzle.query(this.collection.buildQueryArgs("subscribe","count"),t,function(t,r){return t?e(t):void e(null,r.result.count)}),this},n.prototype.renew=function(e,t){var r=Date.now(),n={scope:this.scope,state:this.state,users:this.users},s=this;return!t&&e&&"function"==typeof e&&(t=e,e=null),s.kuzzle.callbackRequired("KuzzleRoom.renew",t),s.lastRenewal&&r-s.lastRenewal<=s.renewalDelay?s:(e&&(s.filters=e),"connected"!==s.kuzzle.state?(s.callback=t,s.kuzzle.subscriptions.pending[s.id]=s,s):s.subscribing?(s.queue.push({action:"renew",args:[e,t]}),s):(s.unsubscribe(),s.roomId=null,s.subscribing=!0,s.callback=t,s.kuzzle.subscriptions.pending[s.id]=s,n.body=s.filters,n=s.kuzzle.addHeaders(n,this.headers),s.kuzzle.query(s.collection.buildQueryArgs("subscribe","on"),n,{metadata:s.metadata},function(e,t){if(delete s.kuzzle.subscriptions.pending[s.id],s.subscribing=!1,e)throw s.queue=[],new Error("Error during Kuzzle subscription: "+e.message);s.lastRenewal=r,s.roomId=t.result.roomId,s.channel=t.result.channel,s.kuzzle.subscriptions[s.roomId]||(s.kuzzle.subscriptions[s.roomId]={}),s.kuzzle.subscriptions[s.roomId][s.id]=s,s.notifier=i.bind(s),s.kuzzle.network.on(s.channel,s.notifier),o.call(s)}),s))},n.prototype.unsubscribe=function(){var e,t=this,r=t.roomId;return s.call(this)?(r&&(t.kuzzle.network.off(t.channel,this.notifier),1===Object.keys(t.kuzzle.subscriptions[r]).length?(delete t.kuzzle.subscriptions[r],0===Object.keys(t.kuzzle.subscriptions.pending).length?t.kuzzle.query(t.collection.buildQueryArgs("subscribe","off"),{body:{roomId:r}}):e=setInterval(function(){0===Object.keys(t.kuzzle.subscriptions.pending).length&&(t.kuzzle.subscriptions[r]||t.kuzzle.query(t.collection.buildQueryArgs("subscribe","off"),{body:{roomId:r}}),clearInterval(e))},100)):delete t.kuzzle.subscriptions[r][t.id],t.roomId=null),t):(t.queue.push({action:"unsubscribe",args:[]}),t)},n.prototype.setHeaders=function(e,t){return this.kuzzle.setHeaders.call(this,e,t),this},e.exports=n},function(e,t,r){function n(e,t,n){if("undefined"!=typeof window){if("undefined"!=typeof WebSocket)return new(r(32))(e,t);if(window.io)return new(r(31))(e,n);throw new Error("Aborting: no websocket support detected and no socket.io library loaded either.")}return new(r(33))(e,t)}e.exports=n},function(e,t){function r(e,t){this.host=e,this.port=t,this.socket=null,this.connect=function(e,t){this.socket=window.io("http://"+this.host+":"+this.port,{reconnection:e,reconnectionDelay:t,forceNew:!0})},this.onConnect=function(e){this.socket.on("connect",e)},this.onConnectError=function(e){this.socket.on("connect_error",e)},this.onDisconnect=function(e){this.socket.on("disconnect",e)},this.onReconnect=function(e){this.socket.on("reconnect",e)},this.once=function(e,t){this.socket.once(e,t)},this.on=function(e,t){this.socket.on(e,t)},this.off=function(e,t){this.socket.off(e,t)},this.send=function(e){this.socket.emit("kuzzle",e)},this.close=function(){this.socket.close(),this.socket=null}}e.exports=r},function(e,t){function r(e,t){var r=this;this.host=e,this.port=t,this.client=null,this.retrying=!1,this.listeners={error:[],connect:[],disconnect:[],reconnect:[]},this.connect=function(e,t){this.client=new WebSocket("ws://"+this.host+":"+this.port),this.client.onopen=function(){r.retrying?n(r.listeners,"reconnect"):n(r.listeners,"connect")},this.client.onclose=function(){n(r.listeners,"disconnect")},this.client.onerror=function(){e&&(r.retrying=!0,setTimeout(function(){r.connect(e,t)},t)),n(r.listeners,"error")},this.client.onmessage=function(e){var t=JSON.parse(e.data);t.room&&r.listeners[t.room]&&n(r.listeners,t.room,t)}},this.onConnect=function(e){this.listeners.connect.push({fn:e,keep:!0})},this.onConnectError=function(e){this.listeners.error.push({fn:e,keep:!0})},this.onDisconnect=function(e){this.listeners.disconnect.push({fn:e,keep:!0})},this.onReconnect=function(e){this.listeners.reconnect.push({fn:e,keep:!0})},this.once=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({fn:t,keep:!1})},this.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({fn:t,keep:!0})},this.off=function(e,t){var r;this.listeners[e]&&(r=this.listeners[e].findIndex(function(e){return e.fn===t}),r!==-1&&(1===this.listeners[e].length&&["error","connect","disconnect","reconnect"].indexOf(e)===-1?delete this.listeners[e]:this.listeners[e].splice(r,1)))},this.send=function(e){this.client&&this.client.readyState===this.client.OPEN&&this.client.send(JSON.stringify(e))},this.close=function(){this.listeners={error:[],connect:[],disconnect:[],reconnect:[]},this.retrying=!1,this.client.close(),this.client=null}}function n(e,t,r){var n,i=e[t].length;for(n=0;n<i;++n)e[t][n].fn(r),e[t][n].keep||(e[t].length>1?(e[t].splice(n,1),--n,--i):delete e[t])}e.exports=r},function(e,t){function r(e,t){var r=this;this.host=e,this.port=t,this.client=null,this.retrying=!1,this.listeners={error:[],connect:[],disconnect:[],reconnect:[]},this.connect=function(e,t){this.client=new i("ws://"+this.host+":"+this.port,{perMessageDeflate:!1}),this.client.on("open",function(){
r.retrying?n(r.listeners,"reconnect"):n(r.listeners,"connect")}),this.client.on("close",function(){n(r.listeners,"disconnect")}),this.client.on("error",function(){e&&(r.retrying=!0,setTimeout(function(){r.connect(e,t)},t)),n(r.listeners,"error")}),this.client.on("message",function(e){var t=JSON.parse(e);t.room&&r.listeners[t.room]&&n(r.listeners,t.room,t)})},this.onConnect=function(e){this.listeners.connect.push({fn:e,keep:!0})},this.onConnectError=function(e){this.listeners.error.push({fn:e,keep:!0})},this.onDisconnect=function(e){this.listeners.disconnect.push({fn:e,keep:!0})},this.onReconnect=function(e){this.listeners.reconnect.push({fn:e,keep:!0})},this.once=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({fn:t,keep:!1})},this.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({fn:t,keep:!0})},this.off=function(e,t){var r;this.listeners[e]&&(r=this.listeners[e].findIndex(function(e){return e.fn===t}),r!==-1&&(1===this.listeners[e].length&&["error","connect","disconnect","reconnect"].indexOf(e)===-1?delete this.listeners[e]:this.listeners[e].splice(r,1)))},this.send=function(e){this.client&&this.client.readyState===this.client.OPEN&&this.client.send(JSON.stringify(e))},this.close=function(){this.listeners={error:[],connect:[],disconnect:[],reconnect:[]},this.retrying=!1,this.client.close(),this.client=null}}function n(e,t,r){var n,i=e[t].length;for(n=0;n<i;++n)e[t][n].fn(r),e[t][n].keep||(e[t].length>1?(e[t].splice(n,1),--n,--i):delete e[t])}var i=require("ws");e.exports=r},function(e,t,r){function n(e,t,r){if(i.call(this,e,t,r),Object.defineProperties(this,{deleteActionName:{value:"deleteProfile"},updateActionName:{value:"updateProfile"}}),e.kuzzle.bluebird)return e.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["hydrate","save"];return n&&i.indexOf(e)!==-1}})}var i=r(2);n.prototype=Object.create(i.prototype,{constructor:{value:n}}),n.prototype.save=function(e,t){var r,n=this;if(!this.content.policies)throw new Error('Argument "policies" is mandatory in a profile. This argument contains an array of objects.');return e&&void 0===t&&"function"==typeof e&&(t=e,e=null),r=this.serialize(),n.kuzzle.query(n.kuzzleSecurity.buildQueryArgs("createOrReplaceProfile"),r,e,function(e){return e?!!t&&t(e):void(t&&t(null,n))}),n},n.prototype.addPolicy=function(e){if("object"!=typeof e||"string"!=typeof e.roleId)throw new Error('Parameter "policies" must be an object containing at least a "roleId" member which must be a string.');return this.content.policies||(this.content.policies=[]),this.content.policies.push(e),this},n.prototype.setPolicies=function(e){if(!Array.isArray(e))throw new Error('Parameter "policies" must be an array of objects containing at least a "roleId" member which must be a string');return e.map(function(e){if("object"!=typeof e||"string"!=typeof e.roleId)throw new Error('Parameter "policies" must be an array of objects containing at least a "roleId" member which must be a string')}),this.content.policies=e,this},n.prototype.serialize=function(){var e={};return this.id&&(e._id=this.id),e.body=this.content,e},n.prototype.getPolicies=function(){return this.content.policies},e.exports=n},function(e,t,r){function n(e,t,r){if(i.call(this,e,t,r),Object.defineProperties(this,{deleteActionName:{value:"deleteRole"},updateActionName:{value:"updateRole"}}),e.kuzzle.bluebird)return e.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["save"];return n&&i.indexOf(e)!==-1}})}var i=r(2);n.prototype=Object.create(i.prototype,{constructor:{value:n}}),n.prototype.save=function(e,t){var r=this.serialize(),n=this;e&&void 0===t&&"function"==typeof e&&(t=e,e=null),n.kuzzle.query(this.kuzzleSecurity.buildQueryArgs("createOrReplaceRole"),r,e,function(e){return e?!!t&&t(e):void(t&&t(null,n))})},e.exports=n},function(e,t,r){function n(e){return Object.defineProperty(this,"kuzzle",{value:e}),Object.defineProperty(this,"buildQueryArgs",{value:function(e){return{controller:"security",action:e}}}),this.kuzzle.bluebird?this.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["roleFactory","profileFactory","userFactory","isActionAllowed"];return n&&i.indexOf(e)===-1}}):this}var i=r(35),o=r(34),s=r(5);n.prototype.getRole=function(e,t,r){var n,o=this;if(!e)throw new Error("Id parameter is mandatory for getRole function");r||"function"!=typeof t||(r=t,t=null),n={_id:e},o.kuzzle.callbackRequired("KuzzleSecurity.getRole",r),o.kuzzle.query(this.buildQueryArgs("getRole"),n,t,function(e,t){return e?r(e):void r(null,new i(o,t.result._id,t.result._source))})},n.prototype.searchRoles=function(e,t,r){var n=this;r||"function"!=typeof t||(r=t,t=null),n.kuzzle.callbackRequired("KuzzleSecurity.searchRoles",r),n.kuzzle.query(this.buildQueryArgs("searchRoles"),{body:e},t,function(e,t){var o;return e?r(e):(o=t.result.hits.map(function(e){return new i(n,e._id,e._source)}),void r(null,{total:t.result.total,roles:o}))})},n.prototype.createRole=function(e,t,r,n){var o=this,s={},u="createRole";if(!e||"string"!=typeof e)throw new Error("KuzzleSecurity.createRole: cannot create a role without a role ID");n||"function"!=typeof r||(n=r,r=null),s._id=e,s.body=t,r&&(u=r.replaceIfExist?"createOrReplaceRole":"createRole"),n?o.kuzzle.query(this.buildQueryArgs(u),s,r,function(e,t){var r;return e?n(e):(r=new i(o,t.result._id,t.result._source),void n(null,r))}):o.kuzzle.query(this.buildQueryArgs(u),s)},n.prototype.updateRole=function(e,t,r,n){var o=this,s={},u="updateRole";if(!e||"string"!=typeof e)throw new Error("KuzzleSecurity.updateRole: cannot update a role without a role ID");n||"function"!=typeof r||(n=r,r=null),s._id=e,s.body=t,n?o.kuzzle.query(this.buildQueryArgs(u),s,r,function(r){return r?n(r):void n(null,new i(o,e,t))}):o.kuzzle.query(this.buildQueryArgs(u),s)},n.prototype.deleteRole=function(e,t,r){var n={_id:e};r||"function"!=typeof t||(r=t,t=null),r?this.kuzzle.query(this.buildQueryArgs("deleteRole"),n,t,function(e,t){return e?r(e):void r(null,t.result._id)}):this.kuzzle.query(this.buildQueryArgs("deleteRole"),n,t)},n.prototype.roleFactory=function(e,t){return new i(this,e,t)},n.prototype.getProfile=function(e,t,r){var n,i=this;if(r||"function"!=typeof t||(r=t,t=null),!e||"string"!=typeof e)throw new Error("Id parameter is mandatory for getProfile function");n={_id:e},i.kuzzle.callbackRequired("KuzzleSecurity.getProfile",r),i.kuzzle.query(this.buildQueryArgs("getProfile"),n,t,function(e,t){return e?r(e):void r(null,new o(i,t.result._id,t.result._source))})},n.prototype.searchProfiles=function(e,t,r){var n=this;r||"function"!=typeof t||(r=t,t=null),n.kuzzle.callbackRequired("KuzzleSecurity.searchProfiles",r),n.kuzzle.query(this.buildQueryArgs("searchProfiles"),{body:e},t,function(e,t){var i;return e?r(e):(i=t.result.hits.map(function(e){return new o(n,e._id,e._source)}),void r(null,{total:t.result.total,profiles:i}))})},n.prototype.createProfile=function(e,t,r,n){var i=this,s={},u="createProfile";if(!e||"string"!=typeof e)throw new Error("KuzzleSecurity.createProfile: cannot create a profile without a profile ID");n||"function"!=typeof r||(n=r,r=null),s._id=e,s.body=t,r&&(u=r.replaceIfExist?"createOrReplaceProfile":"createProfile"),n?i.kuzzle.query(this.buildQueryArgs(u),s,r,function(e,t){var r;return e?n(e):(r=new o(i,t.result._id,t.result._source),void n(null,r))}):i.kuzzle.query(this.buildQueryArgs(u),s)},n.prototype.updateProfile=function(e,t,r,n){var i=this,s={},u="updateProfile";if(!e||"string"!=typeof e)throw new Error("KuzzleSecurity.updateProfile: cannot update a profile without a profile ID");n||"function"!=typeof r||(n=r,r=null),s._id=e,s.body=t,n?i.kuzzle.query(this.buildQueryArgs(u),s,r,function(e,t){var r={};return e?n(e):(Object.keys(t.result._source).forEach(function(e){r[e]=t.result._source[e]}),void n(null,new o(i,t.result._id,r)))}):i.kuzzle.query(this.buildQueryArgs(u),s)},n.prototype.deleteProfile=function(e,t,r){var n={_id:e};r||"function"!=typeof t||(r=t,t=null),r?this.kuzzle.query(this.buildQueryArgs("deleteProfile"),n,t,function(e,t){return e?r(e):void r(null,t.result._id)}):this.kuzzle.query(this.buildQueryArgs("deleteProfile"),n,t)},n.prototype.profileFactory=function(e,t){return new o(this,e,t)},n.prototype.getUser=function(e,t,r){var n,i=this;if(!e||"string"!=typeof e)throw new Error("Id parameter is mandatory for getUser function");r||"function"!=typeof t||(r=t,t=null),n={_id:e},i.kuzzle.callbackRequired("KuzzleSecurity.getUser",r),i.kuzzle.query(this.buildQueryArgs("getUser"),n,t,function(e,t){return e?r(e):void r(null,new s(i,t.result._id,t.result._source))})},n.prototype.searchUsers=function(e,t,r){var n=this;r||"function"!=typeof t||(r=t,t=null),n.kuzzle.callbackRequired("KuzzleSecurity.searchUsers",r),n.kuzzle.query(this.buildQueryArgs("searchUsers"),{body:e},t,function(e,t){var i;return e?r(e):(i=t.result.hits.map(function(e){return new s(n,e._id,e._source)}),void r(null,{total:t.result.total,users:i}))})},n.prototype.createUser=function(e,t,r,n){var i=this,o={},u="createUser";if(!e||"string"!=typeof e)throw new Error("KuzzleSecurity.createUser: cannot create a user without a user ID");n||"function"!=typeof r||(n=r,r=null),o._id=e,o.body=t,r&&(u=r.replaceIfExist?"createOrReplaceUser":"createUser"),n?i.kuzzle.query(this.buildQueryArgs(u),o,null,function(e,t){var r;return e?n(e):(r=new s(i,t.result._id,t.result._source),void n(null,r))}):i.kuzzle.query(this.buildQueryArgs(u),o)},n.prototype.updateUser=function(e,t,r,n){var i=this,o={},u="updateUser";if(!e||"string"!=typeof e)throw new Error("KuzzleSecurity.updateUser: cannot update an user without an user ID");n||"function"!=typeof r||(n=r,r=null),o._id=e,o.body=t,n?i.kuzzle.query(this.buildQueryArgs(u),o,r,function(e,t){return e?n(e):void n(null,new s(i,t.result._id,t.result._source))}):i.kuzzle.query(this.buildQueryArgs(u),o,r)},n.prototype.deleteUser=function(e,t,r){var n={_id:e};r||"function"!=typeof t||(r=t,t=null),r?this.kuzzle.query(this.buildQueryArgs("deleteUser"),n,t,function(e,t){return e?r(e):void r(null,t.result._id)}):this.kuzzle.query(this.buildQueryArgs("deleteUser"),n,t)},n.prototype.userFactory=function(e,t){return new s(this,e,t)},n.prototype.isActionAllowed=function(e,t,r,n,i){var o;if(!e||"object"!=typeof e)throw new Error("rights parameter is mandatory for isActionAllowed function");if(!t||"string"!=typeof t)throw new Error("controller parameter is mandatory for isActionAllowed function");if(!r||"string"!=typeof r)throw new Error("action parameter is mandatory for isActionAllowed function");return o=e.filter(function(e){return e.controller===t||"*"===e.controller}).filter(function(e){return e.action===r||"*"===e.action}).filter(function(e){return e.index===n||"*"===e.index}).filter(function(e){return e.collection===i||"*"===e.collection}),o.some(function(e){return"allowed"===e.value})?"allowed":o.some(function(e){return"conditional"===e.value})?"conditional":"denied"},n.prototype.getUserRights=function(e,t,r){var n={_id:e},i=this;if(!e||"string"!=typeof e)throw new Error("userId parameter is mandatory for getUserRights function");r||"function"!=typeof t||(r=t,t=null),i.kuzzle.callbackRequired("Kuzzle.getUserRights",r),this.kuzzle.query(this.buildQueryArgs("getUserRights"),n,t,function(e,t){return e?r(e):void r(null,t.result.hits)})},e.exports=n},function(e,t){}]);
//# sourceMappingURL=kuzzle.js.map